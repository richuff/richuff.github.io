<!DOCTYPE html>
<html>
  <head>
     
    <meta charset="UTF-8">
    <title>Jetpack Compose - Richu</title>
    <link rel="shortcut icon" href="/static/img/icon.png">
    <link rel="icon" href="/static/img/icon.png" sizes="192x192"/>
    
<link rel="stylesheet" href="/static/kico.css">
<link rel="stylesheet" href="/static/hingle.css">

    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1"/>
    <meta property="og:site_name" content="Richu">
    <meta property="og:title" content="Jetpack Compose"/>
    
    <style>body:before{ content: ''; background-image: url(http://kycloud3.koyoo.cn/2025033176e99202503311036156636.jpg) }</style>
    
<meta name="generator" content="Hexo 7.3.0"></head>

  <body>
    <header>
    <div class="head-title">
        <h4>Richu</h4>
    </div>
    <div class="head-action">
        <div class="toggle-btn"></div>
        <div class="light-btn"></div>
        <div class="search-btn"></div>
    </div>
    <form class="head-search" method="post">
        <input type="text" name="s" placeholder="搜索什么？">
    </form>
    <nav class="head-menu">
        <a href="/">首页</a>
        <div class="has-child">
            <a>分类</a>
            <div class="sub-menu">
                <a class="category-link" href="/categories/Android/">Android</a><a class="category-link" href="/categories/Go/">Go</a><a class="category-link" href="/categories/Java/">Java</a><a class="category-link" href="/categories/QT/">QT</a><a class="category-link" href="/categories/Unity/">Unity</a><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><a class="category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
            </div>
        </div>
        
            <a href="/about">关于我</a>
        
    </nav>
</header>

    <main>
    <div class="wrap min">
        <section class="post-title">
            <h2>Jetpack Compose</h2>
            <div class="post-meta">
                <time class="date">2025.03.18</time>
            
                <span class="category"><a class="category-link" href="/categories/Android/">Android</a></span>
            
            </div>
        </section>
        <article class="post-content">
          
            <p>Jetpack Compose 是用于构建原生 Android 界面的新工具包。 它使用更少的代码、强大的工具和直观的 Kotlin API，可以帮助您简化并加快 Android 界面开发。 在本教程中，您将使用声明性的函数构建一个简单的界面组件。 您无需修改任何 XML 布局，也不需要使用布局编辑器。 相反，您只需调用可组合函数来定义所需的元素，Compose 编译器即会完成后面的所有工作。</p>
<h2 id="1-入门"><a href="#1-入门" class="headerlink" title="1.入门"></a>1.入门</h2><h3 id="1-1-Composable"><a href="#1-1-Composable" class="headerlink" title="1.1.Composable"></a>1.1.Composable</h3><blockquote>
<p> @Composable</p>
<p>声明为组件</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MessageBar</span><span class="params">(msg: <span class="type">String</span>)</span></span>&#123;</span><br><span class="line">    Text(text = msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">PreViewText</span><span class="params">()</span></span>&#123;</span><br><span class="line">    MessageBar(<span class="string">&quot;Context&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-Material-Design"><a href="#1-2-Material-Design" class="headerlink" title="1.2.Material Design"></a>1.2.Material Design</h3><h4 id="1-Theme-kt"><a href="#1-Theme-kt" class="headerlink" title="1.Theme.kt"></a>1.Theme.kt</h4><blockquote>
<p>在ui&#x2F;theme&#x2F;theme.kt</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> DarkColorScheme = darkColorScheme( <span class="comment">//暗色主题</span></span><br><span class="line">    primary = Purple80,</span><br><span class="line">    secondary = PurpleGrey80,</span><br><span class="line">    tertiary = Pink80,</span><br><span class="line">    background = Color.Gray,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> LightColorScheme = lightColorScheme( <span class="comment">//亮色主题</span></span><br><span class="line">    primary = Purple40,</span><br><span class="line">    secondary = PurpleGrey40,</span><br><span class="line">    tertiary = Pink40,</span><br><span class="line">    background = Color.White,</span><br><span class="line">    <span class="comment">/* Other default colors to override</span></span><br><span class="line"><span class="comment">    background = Color(0xFFFFFBFE),</span></span><br><span class="line"><span class="comment">    surface = Color(0xFFFFFBFE),</span></span><br><span class="line"><span class="comment">    onPrimary = Color.White,</span></span><br><span class="line"><span class="comment">    onSecondary = Color.White,</span></span><br><span class="line"><span class="comment">    onTertiary = Color.White,</span></span><br><span class="line"><span class="comment">    onBackground = Color(0xFF1C1B1F),</span></span><br><span class="line"><span class="comment">    onSurface = Color(0xFF1C1B1F),</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>主题的定义</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyTheme</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    darkTheme: <span class="type">Boolean</span> = isSystemInDarkTheme()</span></span>,</span><br><span class="line">    dynamicColor: <span class="built_in">Boolean</span> = <span class="literal">true</span>,</span><br><span class="line">    content: <span class="meta">@Composable</span> () -&gt; <span class="built_in">Unit</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">val</span> colorScheme = <span class="keyword">when</span> &#123;</span><br><span class="line">        dynamicColor &amp;&amp; Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S -&gt; &#123;</span><br><span class="line">            <span class="keyword">val</span> context = LocalContext.current</span><br><span class="line">            <span class="keyword">if</span> (darkTheme) dynamicDarkColorScheme(context) </span><br><span class="line">            <span class="keyword">else</span> dynamicLightColorScheme(context)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        darkTheme -&gt; DarkColorScheme</span><br><span class="line">        <span class="keyword">else</span> -&gt; LightColorScheme</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MaterialTheme(</span><br><span class="line">        colorScheme = colorScheme,</span><br><span class="line">        typography = Typography,</span><br><span class="line">        content = content</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-使用主题"><a href="#2-使用主题" class="headerlink" title="2.使用主题"></a>2.使用主题</h4><blockquote>
<p>MaterialTheme.colorScheme.background</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Row (Modifier.padding(<span class="number">8.</span>dp).</span><br><span class="line">     background(MaterialTheme.colorScheme.background<span class="comment">//使用主题</span></span><br><span class="line">               )) &#123;</span><br><span class="line">    Image(</span><br><span class="line">        painter = painterResource(id = R.drawable.test), </span><br><span class="line">        contentDescription = <span class="literal">null</span>,</span><br><span class="line">        modifier = Modifier</span><br><span class="line">        .size(<span class="number">40.</span>dp)</span><br><span class="line">        .clip(CircleShape)</span><br><span class="line">    )</span><br><span class="line">    Column(Modifier.padding(all = <span class="number">8.</span>dp)) &#123;</span><br><span class="line">        Text(text = msg)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-3-列表与状态"><a href="#1-3-列表与状态" class="headerlink" title="1.3.列表与状态"></a>1.3.列表与状态</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Conversations</span><span class="params">(messages:<span class="type">List</span>&lt;<span class="type">String</span>&gt;)</span></span>&#123;</span><br><span class="line">    LazyColumn &#123;</span><br><span class="line">        items(messages) &#123;message -&gt;</span><br><span class="line">            MessageBar(msg = message)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>调用</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> conversations = listOf(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">Conversations(conversations)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>点击Column改变变量值</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isExpand <span class="keyword">by</span> remember &#123;</span><br><span class="line">    mutableStateOf(<span class="literal">false</span>) </span><br><span class="line">&#125;  <span class="comment">//持久化存储该变量</span></span><br><span class="line"><span class="keyword">val</span> mcolor:Color <span class="keyword">by</span> animateColorAsState(</span><br><span class="line">    targetValue = <span class="keyword">if</span> (isExpand) MaterialTheme.colorScheme.primary </span><br><span class="line">                    <span class="keyword">else</span> MaterialTheme.colorScheme.surface) </span><br><span class="line"><span class="comment">//点击按钮改变颜色</span></span><br><span class="line">Column(</span><br><span class="line">    Modifier</span><br><span class="line">    .padding(all = <span class="number">8.</span>dp)</span><br><span class="line">    .clickable &#123; isExpand = !isExpand &#125;) &#123;</span><br><span class="line"></span><br><span class="line">    Surface (color = mcolor)&#123; <span class="comment">//添加surface组件</span></span><br><span class="line">        Text(text = <span class="string">&quot;hello and <span class="variable">$msg</span>&quot;</span>,</span><br><span class="line">             style = TextStyle(Color.Blue),</span><br><span class="line">             maxLines = <span class="keyword">if</span>(isExpand) <span class="built_in">Int</span>.MAX_VALUE <span class="keyword">else</span> <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-列表"><a href="#1-4-列表" class="headerlink" title="1.4.列表"></a>1.4.列表</h3><blockquote>
<p>通过repeat(100)创建100个列表项</p>
<p>items(100)也可以达到同等效果</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Loop</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> scrollState = rememberScrollState()</span><br><span class="line">    Column(modifier = Modifier.verticalScroll(scrollState)) &#123;</span><br><span class="line">        repeat(<span class="number">100</span>)&#123;</span><br><span class="line">            Text(text = <span class="string">&quot;<span class="variable">$it</span> times&quot;</span>, style = MaterialTheme.typography.titleMedium)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyLoop</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> scrollState = rememberLazyListState()</span><br><span class="line">    LazyColumn(state = scrollState)&#123;</span><br><span class="line">        items(<span class="number">100</span>)&#123;</span><br><span class="line">            Text(text = <span class="string">&quot;<span class="variable">$it</span> times&quot;</span>, style = MaterialTheme.typography.titleMedium)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>协程的使用</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ScrollList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> scrollState = rememberLazyListState()</span><br><span class="line">    <span class="keyword">val</span> coroutineScope = rememberCoroutineScope()</span><br><span class="line">    <span class="keyword">val</span> listSize = <span class="number">100</span>;</span><br><span class="line">    </span><br><span class="line">    Column &#123;</span><br><span class="line">        Row  &#123;</span><br><span class="line">            Button(modifier = Modifier.weight(<span class="number">1f</span>),onClick = &#123;</span><br><span class="line">                <span class="comment">//启动协程</span></span><br><span class="line">                coroutineScope.launch &#123;</span><br><span class="line">                    scrollState.animateScrollToItem(<span class="number">0</span>) <span class="comment">//播放动画,跳转到列表头部</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;top&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            Button(modifier = Modifier.weight(<span class="number">1f</span>),onClick = &#123;</span><br><span class="line">                <span class="comment">//启动协程</span></span><br><span class="line">                coroutineScope.launch &#123; </span><br><span class="line">                    scrollState.animateScrollToItem(listSize -<span class="number">1</span>) <span class="comment">//播放动画,跳转到列表末尾</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;end&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LazyColumn(state = scrollState)&#123;</span><br><span class="line">            items(listSize)&#123;</span><br><span class="line">                ImageItem(it)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ImageItem</span><span class="params">(Index:<span class="type">Int</span>)</span></span>&#123;</span><br><span class="line">    Row (verticalAlignment = Alignment.CenterVertically)&#123;</span><br><span class="line">        Image(painter = painterResource(id = R.drawable.test), contentDescription = <span class="literal">null</span>)</span><br><span class="line">        Text(text = <span class="string">&quot;item <span class="variable">$Index</span>&quot;</span>, style = MaterialTheme.typography.titleMedium)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-5自定义仿修饰符"><a href="#1-5自定义仿修饰符" class="headerlink" title="1.5自定义仿修饰符"></a>1.5自定义仿修饰符</h3><blockquote>
<p>fun Modifier.xxxx &#x3D; this.then()</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Modifier.<span class="title">firstToTop</span><span class="params">(BottomToTop: <span class="type">Dp</span>)</span></span> = <span class="keyword">this</span>.then(</span><br><span class="line">    layout&#123;measurable, constraints -&gt;</span><br><span class="line">        <span class="comment">//测量物体</span></span><br><span class="line">        <span class="keyword">val</span> placeable = measurable.measure(constraints)</span><br><span class="line">        <span class="comment">//获取物体的FirstBaseline</span></span><br><span class="line">        <span class="keyword">val</span> firstBaseLine = placeable[FirstBaseline]</span><br><span class="line">        <span class="comment">//测量得到长度</span></span><br><span class="line">        <span class="keyword">val</span> placeableY = BottomToTop.roundToPx() - firstBaseLine</span><br><span class="line">        <span class="comment">//设置物体</span></span><br><span class="line">        layout(placeable.width,placeable.height + placeableY)&#123;</span><br><span class="line">            placeable.placeRelative(<span class="number">0</span>,placeableY)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TestModifier</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Text(text = <span class="string">&quot;heffff&quot;</span>, modifier =  Modifier.firstToTop(<span class="number">100.</span>dp).background(color = MaterialTheme.colorScheme.surface))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-6自定义组件"><a href="#1-6自定义组件" class="headerlink" title="1.6自定义组件"></a>1.6自定义组件</h3><blockquote>
<p>使用Layout设置组件布局</p>
<p>通过layout设置每个物体的位置</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyOwnColumn</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span> = Modifier,</span></span></span><br><span class="line"><span class="params"><span class="function">    content: @<span class="type">Composable</span> () -&gt; <span class="type">Unit</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>&#123;</span><br><span class="line">    Layout(content = content, modifier = modifier)&#123;measurables, constraints -&gt;</span><br><span class="line">        <span class="comment">//测出每个物体的数据</span></span><br><span class="line">        <span class="keyword">val</span> placeable =  measurables.map&#123;measurable-&gt;</span><br><span class="line">            measurable.measure(constraints)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> yPosition = <span class="number">0</span></span><br><span class="line">        <span class="comment">//将高度设置为父物体的最大高度和最低高度</span></span><br><span class="line">        layout(constraints.maxWidth,constraints.maxHeight)&#123;</span><br><span class="line">            <span class="comment">//设置每个物体的位置</span></span><br><span class="line">            placeable.forEach&#123;</span><br><span class="line">                it.placeRelative(<span class="number">0</span>,yPosition)</span><br><span class="line">                yPosition += it.height</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyOwnColumnTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    MyOwnColumn(modifier = Modifier.padding(<span class="number">8.</span>dp)) &#123;</span><br><span class="line">        Text(text = <span class="string">&quot;test&quot;</span>)</span><br><span class="line">        Text(text = <span class="string">&quot;test&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-进阶使用"><a href="#2-进阶使用" class="headerlink" title="2.进阶使用"></a>2.进阶使用</h2><h3 id="2-1constraintlayout"><a href="#2-1constraintlayout" class="headerlink" title="2.1constraintlayout"></a>2.1constraintlayout</h3><blockquote>
<p>在build.gradle.kt中添加依赖</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(&quot;androidx.constraintlayout:constraintlayout-compose:1.1.1&quot;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>或在build.gradle中添加</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &#x27;androidx.constraintlayout:constraintlayout-compose:1.1.1&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用约束布局</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyConstraintLayout</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ConstraintLayout&#123;</span><br><span class="line">        <span class="keyword">val</span> (button,text) = createRefs()</span><br><span class="line">        Button(onClick = &#123;&#125;, modifier = Modifier.constrainAs(button)&#123;</span><br><span class="line">            top.linkTo(parent.top, margin = <span class="number">16.</span>dp)</span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;button&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将文本组件限制在按钮的底部</span></span><br><span class="line">        Text(text = <span class="string">&quot;Text&quot;</span>, Modifier.constrainAs(text) &#123;</span><br><span class="line">            top.linkTo(button.bottom, margin = <span class="number">16.</span>dp)</span><br><span class="line">            centerHorizontallyTo(parent)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyTowConsLayout</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ConstraintLayout &#123;</span><br><span class="line">        <span class="keyword">val</span> (buttono,buttont,text) = createRefs()</span><br><span class="line"></span><br><span class="line">        Button(onClick = &#123;  &#125;, modifier = Modifier.constrainAs(buttono)&#123;</span><br><span class="line">            top.linkTo(parent.top, margin = <span class="number">16.</span>dp)</span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;Button o&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Text(text = <span class="string">&quot;text&quot;</span>, modifier = Modifier.constrainAs(text)&#123;</span><br><span class="line">            top.linkTo(buttono.bottom, margin = <span class="number">16.</span>dp)</span><br><span class="line">            centerAround(buttono.end)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将buttono和text组合成一个屏障</span></span><br><span class="line">        <span class="keyword">val</span> barrier = createEndBarrier(buttono,text)</span><br><span class="line">        Button(onClick = &#123;&#125;, modifier = Modifier.constrainAs(buttont) &#123;</span><br><span class="line">            top.linkTo(parent.top, margin = <span class="number">16.</span>dp)</span><br><span class="line">            start.linkTo(barrier)</span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;Button t&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>长文本设置换行</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LargeConsLayout</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ConstraintLayout &#123;</span><br><span class="line">        <span class="keyword">val</span> text = createRef()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> guildline = createGuidelineFromStart(fraction = <span class="number">0.5f</span>)</span><br><span class="line">        Text(text = <span class="string">&quot;this is a very very very very very very very very very long text&quot;</span>, modifier = Modifier.constrainAs(text) &#123;</span><br><span class="line">            linkTo(start = guildline,end = parent.end)</span><br><span class="line">            width = Dimension.preferredWrapContent  <span class="comment">//换行</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2解耦API"><a href="#2-2解耦API" class="headerlink" title="2.2解耦API"></a>2.2解耦API</h3><blockquote>
<p>将约束定义在另一个函数，通过解耦API获得约束</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Deconple2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    BoxWithConstraints &#123;</span><br><span class="line">        <span class="comment">//判断横屏还是竖屏</span></span><br><span class="line">        <span class="keyword">val</span>  constraints = <span class="keyword">if</span> (maxWidth &lt; maxHeight)&#123;</span><br><span class="line">            decouple(<span class="number">16.</span>dp) <span class="comment">//竖屏</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            decouple(<span class="number">160.</span>dp) <span class="comment">//横屏</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//使用约束</span></span><br><span class="line">        ConstraintLayout(constraints) &#123;</span><br><span class="line">            Button(onClick = &#123;&#125;, modifier = Modifier.layoutId(<span class="string">&quot;button&quot;</span>)) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;button&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将文本组件限制在按钮的底部</span></span><br><span class="line">            Text(text = <span class="string">&quot;Text&quot;</span>, Modifier.layoutId(<span class="string">&quot;text&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">decouple</span><span class="params">(margin: <span class="type">Dp</span>)</span></span> : ConstraintSet&#123;</span><br><span class="line">    <span class="keyword">return</span> ConstraintSet&#123;</span><br><span class="line">        <span class="keyword">val</span> button = createRefFor(<span class="string">&quot;button&quot;</span>)</span><br><span class="line">        <span class="keyword">val</span> text = createRefFor(<span class="string">&quot;text&quot;</span>)</span><br><span class="line"></span><br><span class="line">        constrain(button)&#123;</span><br><span class="line">            top.linkTo(parent.top, margin)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        constrain(text)&#123;</span><br><span class="line">            top.linkTo(button.bottom, margin)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3Intrinsics"><a href="#2-3Intrinsics" class="headerlink" title="2.3Intrinsics"></a>2.3Intrinsics</h3><blockquote>
<p>获取子元素的值</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TwoTexts</span><span class="params">(modifier: <span class="type">Modifier</span> = Modifier)</span></span>&#123;</span><br><span class="line">    <span class="comment">//高度为最小值</span></span><br><span class="line">    Row (modifier = Modifier.height(IntrinsicSize.Min))&#123;</span><br><span class="line">        Text(text = <span class="string">&quot;Hi&quot;</span>,modifier = Modifier</span><br><span class="line">            .padding(<span class="number">1.</span>dp)</span><br><span class="line">            .weight(<span class="number">1f</span>)</span><br><span class="line">            .wrapContentWidth(Alignment.Start))</span><br><span class="line">        <span class="comment">//分割线</span></span><br><span class="line">        Divider(color = Color.Black, modifier = Modifier</span><br><span class="line">            .fillMaxHeight()</span><br><span class="line">            .width(<span class="number">1.</span>dp))</span><br><span class="line"></span><br><span class="line">        Text(text = <span class="string">&quot;Android&quot;</span>,modifier = Modifier</span><br><span class="line">            .padding(<span class="number">1.</span>dp)</span><br><span class="line">            .weight(<span class="number">1f</span>)</span><br><span class="line">            .wrapContentWidth(Alignment.End))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实现效果</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://kycloud3.koyoo.cn/20250307ea780202503071104106999.png"><img src="http://kycloud3.koyoo.cn/20250307ea780202503071104106999.png" alt="20250307ea780202503071104106999.png"></a></p>
<h2 id="3-compose状态"><a href="#3-compose状态" class="headerlink" title="3.compose状态"></a>3.compose状态</h2><h3 id="3-1无状态组件"><a href="#3-1无状态组件" class="headerlink" title="3.1无状态组件"></a>3.1无状态组件</h3><blockquote>
<p>TodoItems</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">ToDoItems</span>(<span class="keyword">val</span> task:String,<span class="keyword">val</span> icon:TodoIcon = TodoIcon.default,<span class="keyword">val</span> id:UUID = UUID.randomUUID())</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">TodoIcon</span>(</span><br><span class="line">    <span class="keyword">val</span> imageVector:ImageVector,</span><br><span class="line">    <span class="keyword">val</span> desc:String</span><br><span class="line">)&#123;</span><br><span class="line">    SQU(Icons.Default.Favorite,<span class="string">&quot;喜欢&quot;</span>);</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">            <span class="keyword">val</span> default = SQU</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>组件</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TwoTexts</span><span class="params">(modifier: <span class="type">Modifier</span> = Modifier)</span></span>&#123;</span><br><span class="line">    <span class="comment">//高度为最小值</span></span><br><span class="line">    Row (modifier = Modifier.height(IntrinsicSize.Min))&#123;</span><br><span class="line">        Text(text = <span class="string">&quot;Hi&quot;</span>,modifier = Modifier</span><br><span class="line">            .padding(<span class="number">1.</span>dp)</span><br><span class="line">            .weight(<span class="number">1f</span>)</span><br><span class="line">            .wrapContentWidth(Alignment.Start))</span><br><span class="line">        <span class="comment">//分割线</span></span><br><span class="line">        Divider(color = Color.Black, modifier = Modifier</span><br><span class="line">            .fillMaxHeight()</span><br><span class="line">            .width(<span class="number">1.</span>dp))</span><br><span class="line"></span><br><span class="line">        Text(text = <span class="string">&quot;Android&quot;</span>,modifier = Modifier</span><br><span class="line">            .padding(<span class="number">1.</span>dp)</span><br><span class="line">            .weight(<span class="number">1f</span>)</span><br><span class="line">            .wrapContentWidth(Alignment.End))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TodoSreen</span><span class="params">(items:<span class="type">List</span>&lt;<span class="type">ToDoItems</span>&gt;)</span></span>&#123;</span><br><span class="line">    Column&#123;</span><br><span class="line">        LazyColumn(modifier = Modifier.weight(<span class="number">1f</span>), contentPadding = PaddingValues(<span class="number">10.</span>dp))  &#123;</span><br><span class="line">            items(items)&#123;</span><br><span class="line">                TodoRow(it, modifier = Modifier.fillParentMaxWidth())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Button(onClick = &#123;&#125;, modifier = Modifier.padding(<span class="number">16.</span>dp).fillMaxWidth()) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;click me!!!&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TodoRow</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    todo:<span class="type">ToDoItems</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span> = Modifier,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="comment">//content:@Composable ()-&gt;Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>&#123;</span><br><span class="line">    Row (modifier = modifier.padding(vertical = <span class="number">6.</span>dp, horizontal = <span class="number">16.</span>dp),</span><br><span class="line">        horizontalArrangement = Arrangement.SpaceBetween <span class="comment">//子元素水平布局</span></span><br><span class="line">    )&#123;</span><br><span class="line">        Text(text = todo.task)</span><br><span class="line">		</span><br><span class="line">        Icon(imageVector = todo.icon.imageVector, contentDescription = todo.icon.desc)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2非结构化状态"><a href="#3-2非结构化状态" class="headerlink" title="3.2非结构化状态"></a>3.2非结构化状态</h3><blockquote>
<p>在gradle.build.kt文件中添加</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">buildFeatures &#123;</span><br><span class="line">    compose = <span class="literal">true</span></span><br><span class="line">    viewBinding = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>新建activity</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestCom</span> :<span class="type">AppCompatActivity</span>()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bindding <span class="keyword">by</span> lazy &#123;</span><br><span class="line">        ActivityTestComBinding.inflate(layoutInflater)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(bindding.root)</span><br><span class="line"></span><br><span class="line">        bindding.input.doAfterTextChanged&#123; text -&gt;</span><br><span class="line">            uploadText(text.toString())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">uploadText</span><span class="params">(text: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        bindding.text.text = text</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用ViewModel</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestViewModel</span>:<span class="type">ViewModel</span>()&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> _name = MutableLiveData(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> name: LiveData&lt;String&gt; = _name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onNameChanged</span><span class="params">(newname:<span class="type">String</span>)</span></span>&#123;</span><br><span class="line">        _name.value = newname</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestCom</span> :<span class="type">AppCompatActivity</span>()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> testmodel <span class="keyword">by</span> viewModels&lt;TestViewModel&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bindding <span class="keyword">by</span> lazy &#123;</span><br><span class="line">        ActivityTestComBinding.inflate(layoutInflater)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(bindding.root)</span><br><span class="line"></span><br><span class="line">        bindding.input.doAfterTextChanged&#123; text -&gt;</span><br><span class="line">            testmodel.onNameChanged(text.toString())</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        testmodel.name.observe(<span class="keyword">this</span>)&#123;</span><br><span class="line">            text-&gt;</span><br><span class="line">                bindding.text.text = text</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3状态与状态提升"><a href="#3-3状态与状态提升" class="headerlink" title="3.3状态与状态提升"></a>3.3状态与状态提升</h3><blockquote>
<p>将TodoItemList作为状管理</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TodoItemModel</span> : <span class="type">ViewModel</span>()&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> _todos = MutableLiveData(listOf&lt;ToDoItems&gt;())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> todos : LiveData&lt;List&lt;ToDoItems&gt;&gt; = _todos</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加item</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">AddItem</span><span class="params">(todo:<span class="type">ToDoItems</span>)</span></span>&#123;</span><br><span class="line">        _todos.value = _todos.value!! + listOf(todo)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除item</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">DeleteItem</span><span class="params">(todo:<span class="type">ToDoItems</span>)</span></span>&#123;</span><br><span class="line">        _todos.value = _todos.value!!.toMutableList().also &#123;</span><br><span class="line">            it.remove(todo)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>构建主界面</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> todoModel <span class="keyword">by</span> viewModels&lt;TodoItemModel&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    enableEdgeToEdge()</span><br><span class="line"></span><br><span class="line">    setContent &#123;</span><br><span class="line">        <span class="keyword">val</span> todolist:List&lt;ToDoItems&gt; <span class="keyword">by</span> todoModel.todos.observeAsState(listOf())</span><br><span class="line">        Scaffold&#123;</span><br><span class="line">            Column (modifier = Modifier.padding(it))&#123;</span><br><span class="line">                <span class="comment">//将todolist和 添加item 删除item传递到下一级组件</span></span><br><span class="line">                TodoSreen(todolist, ItemAdd = &#123;todoModel.AddItem(it)&#125;, ItemDelete = &#123;todoModel.DeleteItem(it)&#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4remember"><a href="#3-4remember" class="headerlink" title="3.4remember"></a>3.4remember</h3><h4 id="1-保留状态"><a href="#1-保留状态" class="headerlink" title="1. 保留状态"></a>1. <strong>保留状态</strong></h4><p>当你需要在 Composable 函数中保存某个状态，并且希望在组件重组时保留这个状态，可以使用 <code>remember</code>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">Button(onClick = &#123; count++ &#125;) &#123;</span><br><span class="line">    Text(<span class="string">&quot;Clicked <span class="variable">$count</span> times&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>count</code> 的值在按钮点击时会增加，并且在组件重组时，<code>count</code> 的值会被保留。</p>
<h4 id="2-避免重复计算"><a href="#2-避免重复计算" class="headerlink" title="2.避免重复计算"></a>2.<strong>避免重复计算</strong></h4><p>如果你有一个复杂的计算结果，不希望在每次重组时重新计算，可以使用 <code>remember</code> 来缓存计算结果。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> complexResult = remember &#123;</span><br><span class="line">    computeComplexResult() <span class="comment">// 假设这是一个耗时的计算函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-带条件的-remember"><a href="#3-带条件的-remember" class="headerlink" title="3. 带条件的 remember"></a>3. <strong>带条件的 remember</strong></h4><p>你可以根据某些条件来决定是否重新计算值。<code>remember</code> 接收可变参数 <code>keys</code>，当这些 <code>keys</code> 的值发生变化时，<code>remember</code> 会重新计算并保存新的值。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> text <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="string">&quot;&quot;</span>) &#125;</span><br><span class="line"><span class="keyword">val</span> reversedText = remember(text) &#123;</span><br><span class="line">    text.reversed()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>reversedText</code> 会在 <code>text</code> 发生变化时重新计算。</p>
<h4 id="4-结合-mutableStateOf-使用"><a href="#4-结合-mutableStateOf-使用" class="headerlink" title="4. 结合 mutableStateOf 使用"></a>4. <strong>结合 mutableStateOf 使用</strong></h4><p><code>remember</code> 常与 <code>mutableStateOf</code> 一起使用，用于创建可变状态。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isExpanded <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">Button(onClick = &#123; isExpanded = !isExpanded &#125;) &#123;</span><br><span class="line">    Text(<span class="string">&quot;Expand: <span class="variable">$isExpanded</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-保存多个值"><a href="#5-保存多个值" class="headerlink" title="5. 保存多个值"></a>5. <strong>保存多个值</strong></h4><p><code>remember</code> 可以保存多个值，或者保存一个包含多个值的对象。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">User</span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> user = remember &#123;</span><br><span class="line">    User(<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-与-ViewModel-结合使用"><a href="#6-与-ViewModel-结合使用" class="headerlink" title="6. 与 ViewModel 结合使用"></a>6. <strong>与 ViewModel 结合使用</strong></h4><p>在 Jetpack Compose 中，<code>remember</code> 也可以与 <code>ViewModel</code> 结合使用，保存与 UI 相关的状态。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> viewModel = viewModel&lt;MyViewModel&gt;()</span><br><span class="line"><span class="keyword">var</span> <span class="keyword">data</span> <span class="keyword">by</span> remember &#123; mutableStateOf(emptyList&lt;String&gt;()) &#125;</span><br><span class="line">LaunchedEffect(<span class="built_in">Unit</span>) &#123;</span><br><span class="line">    <span class="keyword">data</span> = viewModel.loadData()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-rememberSaveable"><a href="#7-rememberSaveable" class="headerlink" title="7. rememberSaveable"></a>7. <strong>rememberSaveable</strong></h4><p>如果你需要在配置更改（如屏幕旋转）时保留状态，可以使用 <code>rememberSaveable</code>，它会在配置更改时自动保存和恢复状态。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> count <span class="keyword">by</span> rememberSaveable &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">Button(onClick = &#123; count++ &#125;) &#123;</span><br><span class="line">    Text(<span class="string">&quot;Clicked <span class="variable">$count</span> times&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-5mutableStateOf"><a href="#3-5mutableStateOf" class="headerlink" title="3.5mutableStateOf"></a>3.5mutableStateOf</h3><ol>
<li><p><strong>创建可组合函数</strong>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">StateExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建可观察的状态</strong>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> (count,setCount) = remember &#123;</span><br><span class="line">        mutableStateOf(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>mutableStateOf(0)</code>：创建一个初始值为 0 的可观察状态。</li>
<li><code>remember</code>：确保在组件重新绘制时，状态不会被重置。</li>
<li><code>by</code>：使用委托语法，使 <code>count</code> 变成一个可读写的属性。</li>
</ul>
</li>
<li><p><strong>创建按钮并处理点击事件</strong>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Button(onClick = &#123; count++ &#125;) &#123;</span><br><span class="line">    Text(<span class="string">&quot;Clicked <span class="variable">$count</span> times&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Button</code>：一个可组合的按钮组件。</li>
<li><code>onClick</code>：点击按钮时的回调函数，这里增加 <code>count</code> 的值。</li>
</ul>
</li>
</ol>
<p>工作原理</p>
<ol>
<li><strong>状态创建</strong>：<ul>
<li><code>mutableStateOf</code> 创建一个 <code>MutableState</code> 对象，内部包含一个值和一些元数据。</li>
<li><code>remember</code> 确保在组件重新绘制时，状态不会被重置。</li>
</ul>
</li>
<li><strong>状态观察</strong>：<ul>
<li>当 <code>count</code> 被使用时，Compose 运行时会自动将当前可组合函数注册为 <code>count</code> 的观察者。</li>
</ul>
</li>
<li><strong>状态更新</strong>：<ul>
<li>当 <code>count</code> 的值发生变化时（如点击按钮时 <code>count++</code>），Compose 运行时会检测到状态变化。</li>
</ul>
</li>
<li><strong>触发重组</strong>：<ul>
<li>在下一个组合周期，Compose 运行时会重新执行使用了 <code>count</code> 的可组合函数，更新 UI。</li>
</ul>
</li>
</ol>
<p>注意事项</p>
<ul>
<li><strong>状态保存</strong>：<ul>
<li><code>mutableStateOf</code> 本身并不保存状态，它只是创建一个可观察的状态对象。如果需要在组件重新绘制时保持状态，通常需要结合 <code>remember</code> 函数一起使用。</li>
</ul>
</li>
<li><strong>状态变化检测</strong>：<ul>
<li>Compose 的状态变化检测是基于引用的。对于复杂对象，如果只是修改了对象的内部属性，而没有改变对象本身，Compose 可能不会检测到状态的变化。这种情况下，可能需要手动通知状态变化。</li>
</ul>
</li>
<li><strong>性能优化</strong>：<ul>
<li>虽然 <code>mutableStateOf</code> 提供了强大的状态管理能力，但在实际开发中，应尽量减少不必要的状态更新，以提高应用的性能。</li>
</ul>
</li>
</ul>
<h3 id="3-6输入框"><a href="#3-6输入框" class="headerlink" title="3.6输入框"></a>3.6输入框</h3><blockquote>
<p>小项目实战</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入框</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">InputEdit</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    text:<span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span> = Modifier,</span></span></span><br><span class="line"><span class="params"><span class="function">    onTextChange:(<span class="type">String</span>)-&gt;<span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>&#123;</span><br><span class="line">    TextField(onValueChange = onTextChange,</span><br><span class="line">        maxLines = <span class="number">1</span>,</span><br><span class="line">        value = text,</span><br><span class="line">        modifier = modifier,</span><br><span class="line">        colors = TextFieldDefaults.colors(unfocusedTextColor = Color.Magenta))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//按钮</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">InputButton</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    onClick:()-&gt;<span class="type">Unit</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    text: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span> = Modifier,</span></span></span><br><span class="line"><span class="params"><span class="function">    enable : <span class="type">Boolean</span> = <span class="literal">true</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>&#123;</span><br><span class="line">    TextButton(onClick = onClick, enabled = enable, modifier = modifier,</span><br><span class="line">        shape = CircleShape,</span><br><span class="line">        colors = ButtonDefaults.buttonColors()) &#123;</span><br><span class="line">        Text(text = text)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimateIconRow</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    icon:<span class="type">TodoIcon</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    OnIconChange:(<span class="type">TodoIcon</span>)-&gt;<span class="type">Unit</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span> = Modifier,</span></span></span><br><span class="line"><span class="params"><span class="function">    visiable:<span class="type">Boolean</span> = <span class="literal">true</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> enter = remember &#123;</span><br><span class="line">        fadeIn(animationSpec = TweenSpec(<span class="number">200000</span>, easing = FastOutSlowInEasing))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> exit = remember &#123;</span><br><span class="line">        fadeOut(animationSpec = TweenSpec(<span class="number">200000</span>, easing = FastOutSlowInEasing))</span><br><span class="line">    &#125;</span><br><span class="line">    Box(modifier = modifier.defaultMinSize(minHeight = <span class="number">16.</span>dp))&#123;</span><br><span class="line">        AnimatedVisibility(visiable,enter = enter , exit = exit) &#123;</span><br><span class="line">            IconRow(icon = icon,OnIconChange = OnIconChange,modifier = modifier)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">SelectableButton</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier:<span class="type">Modifier</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    icon: <span class="type">ImageVector</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    desc: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    OnIconSelect: () -&gt; <span class="type">Unit</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    isSelected: <span class="type">Boolean</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> tint = <span class="keyword">if</span> (isSelected) Color.Magenta <span class="keyword">else</span> MaterialTheme.colorScheme.surface.copy(<span class="number">0.6f</span>)</span><br><span class="line"></span><br><span class="line">    TextButton(onClick = &#123;OnIconSelect()&#125;, shape = CircleShape, modifier = modifier) &#123;</span><br><span class="line">        Column &#123;</span><br><span class="line">            Icon(imageVector = icon, contentDescription = desc)</span><br><span class="line">            <span class="keyword">if</span> (isSelected)&#123;</span><br><span class="line">                Box (modifier = Modifier</span><br><span class="line">                    .padding(top = <span class="number">3.</span>dp)</span><br><span class="line">                    .height(<span class="number">1.</span>dp)</span><br><span class="line">                    .width(icon.defaultWidth)</span><br><span class="line">                    .background(color = tint))&#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                Spacer(modifier = Modifier.height(<span class="number">4.</span>dp))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">IconRow</span><span class="params">(icon: <span class="type">TodoIcon</span>, OnIconChange: (<span class="type">TodoIcon</span>) -&gt; <span class="type">Unit</span>,modifier : <span class="type">Modifier</span> = Modifier)</span></span> &#123;</span><br><span class="line">    Row (modifier) &#123;</span><br><span class="line">        <span class="keyword">for</span> (todoicon <span class="keyword">in</span> TodoIcon.entries)&#123;</span><br><span class="line">            SelectableButton(</span><br><span class="line">                modifier = Modifier,</span><br><span class="line">                icon = todoicon.imageVector,</span><br><span class="line">                desc = todoicon.desc,</span><br><span class="line">                OnIconSelect = &#123;OnIconChange(todoicon)&#125;,</span><br><span class="line">                isSelected = todoicon == icon</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">InputList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//记录输入的值</span></span><br><span class="line">    <span class="keyword">val</span> (text,setText) = remember &#123;</span><br><span class="line">        mutableStateOf(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//记录标记的icon</span></span><br><span class="line">    <span class="keyword">val</span> (icon,setIcon) = remember &#123;</span><br><span class="line">        mutableStateOf(TodoIcon.default)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> iconVisable = text.isNotBlank()</span><br><span class="line">    Column &#123;</span><br><span class="line">        Row (modifier = Modifier.padding(<span class="number">10.</span>dp))&#123;</span><br><span class="line">            InputEdit(</span><br><span class="line">                text = text, onTextChange = setText,</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .padding(end = <span class="number">8.</span>dp)</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            InputButton(onClick = &#123;&#125; ,</span><br><span class="line">                enable = text.isNotBlank(),</span><br><span class="line">                text = <span class="string">&quot;提交&quot;</span>,</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .align(Alignment.CenterVertically)</span><br><span class="line">                    .fillMaxWidth())</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断是否可以显示IconRow</span></span><br><span class="line">        <span class="keyword">if</span> (iconVisable)&#123;</span><br><span class="line">            AnimateIconRow(icon,setIcon, modifier = Modifier.padding(<span class="number">8.</span>dp))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-7状态恢复"><a href="#3-7状态恢复" class="headerlink" title="3.7状态恢复"></a>3.7状态恢复</h3><h4 id="1-Parcelize"><a href="#1-Parcelize" class="headerlink" title="1.Parcelize"></a>1.Parcelize</h4><p>在 Kotlin 中，<code>@Parcelize</code> 是一个注解，用于简化实现 <code>Parcelable</code> 接口的过程。<code>Parcelable</code> 是 Android 中用于序列化对象的接口，以便对象可以在不同组件之间传递，例如在 <code>Intent</code> 中传递或者保存在 <code>Bundle</code> 中。</p>
<blockquote>
<p>使用步骤</p>
</blockquote>
<ol>
<li><p><strong>添加插件</strong><br>在项目的 <code>build.gradle.kt</code> 文件中添加 <code>kotlin-parcelize</code> 插件：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id(<span class="string">&quot;kotlin-parcelize&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>注解数据类</strong><br>使用 <code>@Parcelize</code> 注解你的数据类，并让它继承 <code>Parcelable</code> 接口：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Parcelize</span></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">City</span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> country: String) : Parcelable</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用对象</strong><br>现在，你可以在需要传递对象的地方使用这个数据类，例如在 <code>Intent</code> 中：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> intent = Intent(<span class="keyword">this</span>, AnotherActivity::<span class="keyword">class</span>.java)</span><br><span class="line">intent.putExtra(<span class="string">&quot;city&quot;</span>, City(<span class="string">&quot;Beijing&quot;</span>, <span class="string">&quot;China&quot;</span>))</span><br><span class="line">startActivity(intent)</span><br></pre></td></tr></table></figure>

<p>或者在 <code>rememberSaveable</code> 中保存状态：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">CityScreen</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> city <span class="keyword">by</span> rememberSaveable &#123; mutableStateOf(City(<span class="string">&quot;London&quot;</span>, <span class="string">&quot;UK&quot;</span>)) &#125;</span><br><span class="line">    Row(verticalAlignment = Alignment.CenterVertically, modifier = Modifier.padding(<span class="number">10.</span>dp)) &#123;</span><br><span class="line">        TextButton(onClick = &#123; city = City(<span class="string">&quot;Beijing&quot;</span>, <span class="string">&quot;CHINA&quot;</span>) &#125;) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;Click to change&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        Text(text = <span class="string">&quot;<span class="subst">$&#123;city.country&#125;</span>-<span class="subst">$&#123;city.name&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>注意事项</p>
</blockquote>
<ul>
<li><strong>所有属性必须可序列化</strong>：<code>@Parcelize</code> 注解的数据类的所有属性必须是可序列化的，即它们本身要么是基本类型，要么也是实现了 <code>Parcelable</code> 或 <code>Serializable</code> 的类。</li>
<li>**自定义 <code>Saver</code>**：如果 <code>@Parcelize</code> 不适合你的场景，你还可以使用 <code>mapSaver</code> 或 <code>listSaver</code> 自定义存储规则。</li>
</ul>
<p>通过这种方式，你可以轻松地在 Android 应用中实现对象的序列化和传递。</p>
<h4 id="mapSaver的作用"><a href="#mapSaver的作用" class="headerlink" title="mapSaver的作用"></a>mapSaver的作用</h4><ul>
<li><p><strong>定义保存规则</strong>：mapSaver用于定义如何将对象转换为<code>Map&lt;String, Any&gt;</code>的结构进行保存。它允许开发者自定义保存和恢复的规则，通过指定键值对来存储对象的属性。</p>
</li>
<li><p><strong>保存复杂对象</strong>：当对象的属性较多或结构复杂时，使用mapSaver可以更清晰地指定每个属性的保存方式。</p>
</li>
<li><p><strong>示例代码</strong>：</p>
<p>kotlin复制</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">City</span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> country: String)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> CitySaver = run &#123;</span><br><span class="line">    <span class="keyword">val</span> nameKey = <span class="string">&quot;Name&quot;</span></span><br><span class="line">    <span class="keyword">val</span> countryKey = <span class="string">&quot;Country&quot;</span></span><br><span class="line">    mapSaver(</span><br><span class="line">        save = &#123; mapOf(nameKey to it.name, countryKey to it.country) &#125;,</span><br><span class="line">        restore = &#123; City(it[nameKey] <span class="keyword">as</span> String, it[countryKey] <span class="keyword">as</span> String) &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">CityScreen</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> selectedCity = rememberSaveable(stateSaver = CitySaver) &#123;</span><br><span class="line">        mutableStateOf(City(<span class="string">&quot;Madrid&quot;</span>, <span class="string">&quot;Spain&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="listSaver的作用"><a href="#listSaver的作用" class="headerlink" title="listSaver的作用"></a>listSaver的作用</h4><ul>
<li><p><strong>简化保存过程</strong>：listSaver用于将对象转换为<code>List</code>的数据结构进行保存。它使用列表的索引作为键，避免了为映射定义键的麻烦。</p>
</li>
<li><p><strong>适用于简单对象</strong>：对于简单的对象结构，使用listSaver可以更方便地进行状态保存和恢复。</p>
</li>
<li><p><strong>示例代码</strong>：</p>
<p>kotlin复制</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">City</span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> country: String)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> CitySaver = listSaver&lt;City, Any&gt;(</span><br><span class="line">    save = &#123; listOf(it.name, it.country) &#125;,</span><br><span class="line">    restore = &#123; City(it[<span class="number">0</span>] <span class="keyword">as</span> String, it[<span class="number">1</span>] <span class="keyword">as</span> String) &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">CityScreen</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> selectedCity = rememberSaveable(stateSaver = CitySaver) &#123;</span><br><span class="line">        mutableStateOf(City(<span class="string">&quot;Madrid&quot;</span>, <span class="string">&quot;Spain&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="mapSaver和listSaver的区别"><a href="#mapSaver和listSaver的区别" class="headerlink" title="mapSaver和listSaver的区别"></a>mapSaver和listSaver的区别</h4><ul>
<li><strong>数据结构不同</strong>：mapSaver将对象转换为<code>Map</code>结构，而listSaver将对象转换为<code>List</code>结构。</li>
<li><strong>使用场景不同</strong>：当需要明确的键来标识属性时，mapSaver更合适；而当数据结构简单且顺序固定时，listSaver更方便。</li>
<li><strong>灵活性不同</strong>：mapSaver在处理复杂对象时更灵活，因为它允许开发者自定义每个属性的键；而listSaver在处理简单对象时更简洁。</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//指定mapSaver，用于在存储的时候如何构建一个Map对象，获取时如何构建一个city对象</span></span><br><span class="line">    <span class="keyword">val</span> citySaver = run &#123;</span><br><span class="line">        <span class="keyword">val</span> nameKey = <span class="string">&quot;Name&quot;</span></span><br><span class="line">        <span class="keyword">val</span> countryKey = <span class="string">&quot;Country&quot;</span></span><br><span class="line">        mapSaver(save = &#123; mapOf(nameKey to it.name,countryKey to it.country)&#125;,</span><br><span class="line">            restore = &#123;MainActivity.OCity(it[nameKey] <span class="keyword">as</span> String,it[countryKey] <span class="keyword">as</span> String)&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//指定listSaver,用于在存储的时候构建一个List对象，读取时如何构建一个city对象</span></span><br><span class="line">    <span class="keyword">val</span> citySavert = listSaver(</span><br><span class="line">        save = &#123; listOf(it.name,it.country)&#125;,</span><br><span class="line">        restore = &#123;MainActivity.OCity(it[<span class="number">0</span>] <span class="keyword">as</span> String,it[<span class="number">1</span>] <span class="keyword">as</span> String)&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可以在屏幕选转之后保存数据</span></span><br><span class="line">    <span class="keyword">val</span> (city,setCity) = rememberSaveable(stateSaver = citySavert) &#123;</span><br><span class="line">        mutableStateOf(MainActivity.OCity(<span class="string">&quot;Madrid&quot;</span>,<span class="string">&quot;Spain&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*    val (citys,setCitys) = remember &#123;</span></span><br><span class="line"><span class="comment">        mutableStateOf(MainActivity.OCity(&quot;Madrid&quot;,&quot;Spain&quot;))</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    Row (verticalAlignment = Alignment.CenterVertically, modifier = Modifier.padding(<span class="number">10.</span>dp))&#123;</span><br><span class="line">        TextButton(onClick = &#123; setCity(MainActivity.OCity(<span class="string">&quot;Beijing&quot;</span>,<span class="string">&quot;China&quot;</span>)) &#125;) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;Change&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        Text(text = city.toString())</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-8CompositionLocalProvider"><a href="#3-8CompositionLocalProvider" class="headerlink" title="3.8CompositionLocalProvider"></a>3.8CompositionLocalProvider</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MaterialTheme &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        Text(text = <span class="string">&quot;1&quot;</span>)</span><br><span class="line">        CompositionLocalProvider(LocalContentColor provides LocalContentColor.current.copy(alpha = <span class="number">0.6f</span>)) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            Text(text = <span class="string">&quot;3&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        CompositionLocalProvider(LocalContentColor provides LocalContentColor.current.copy(alpha = <span class="number">0.38f</span>)) &#123;</span><br><span class="line">            Descendant()</span><br><span class="line">        &#125;</span><br><span class="line">        FruitTitle(size = <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>string.xml文件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;app_name&quot;</span>&gt;</span>Kcom<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plurals</span> <span class="attr">name</span>=<span class="string">&quot;fruit_title&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">quantity</span>=<span class="string">&quot;one&quot;</span>&gt;</span>fruit<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">quantity</span>=<span class="string">&quot;other&quot;</span>&gt;</span>fruits<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plurals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果size为1则匹配one</p>
<p>size为2,3….则匹配other</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FruitTitle(size = <span class="number">1</span>）</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">FruitTitle</span><span class="params">(size:<span class="type">Int</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> resource = LocalContext.current.resources</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> fruit =  resource.getQuantityString(R.plurals.fruit_title,size)</span><br><span class="line">    Text(text = fruit)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>自定义compositionLocal</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义数据类</span></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Elevations</span>(<span class="keyword">val</span> cradDp: Dp = <span class="number">0.</span>dp)</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义CompositionLocal</span></span><br><span class="line"><span class="keyword">val</span> LocalElevations = compositionLocalOf &#123;</span><br><span class="line">    Elevations()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义CardElevation</span></span><br><span class="line"><span class="keyword">object</span> CardElevation&#123;</span><br><span class="line">    <span class="keyword">val</span> high:Elevations</span><br><span class="line">        <span class="keyword">get</span>() = Elevations(<span class="number">10.</span>dp)</span><br><span class="line">    <span class="keyword">val</span> low:Elevations</span><br><span class="line">        <span class="keyword">get</span>() = Elevations(<span class="number">5.</span>dp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        CompositionLocalProvider(LocalElevations provides CardElevation.low) &#123;</span><br><span class="line">            MyCard(background = MaterialTheme.colorScheme.onSurface.copy(alpha = <span class="number">0.05f</span>)) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        MyCard(background = MaterialTheme.colorScheme.onSurface.copy(alpha = <span class="number">0.2f</span>)) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyCard</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    elevation: <span class="type">Dp</span> = LocalElevations.current.cradDp,</span></span></span><br><span class="line"><span class="params"><span class="function">    background: <span class="type">Color</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    content: @<span class="type">Composable</span> <span class="type">ColumnScope</span>.()-&gt;<span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>&#123;</span><br><span class="line">    Card(elevation = CardDefaults.cardElevation(defaultElevation = elevation),modifier = Modifier.size(<span class="number">200.</span>dp), colors = CardDefaults.cardColors(containerColor = background), content = content)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-主题"><a href="#4-主题" class="headerlink" title="4.主题"></a>4.主题</h2><h3 id="1-定义主题"><a href="#1-定义主题" class="headerlink" title="1.定义主题"></a>1.定义主题</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> DarkColorScheme = darkColorScheme(</span><br><span class="line">    primary = Purple80,</span><br><span class="line">    secondary = PurpleGrey80,</span><br><span class="line">    tertiary = Pink80,</span><br><span class="line">    background = Color(<span class="number">0xFFFFFBFE</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> LightColorScheme = lightColorScheme(</span><br><span class="line">    primary = Purple40,</span><br><span class="line">    secondary = PurpleGrey40,</span><br><span class="line">    tertiary = Pink40,</span><br><span class="line">    background = Color(<span class="number">0xFFFFFBFE</span>),</span><br><span class="line">    surface = Color(<span class="number">0xFFFFFBFE</span>),</span><br><span class="line">    onPrimary = Color.White,</span><br><span class="line">    onSecondary = Color.White,</span><br><span class="line">    onTertiary = Color.White,</span><br><span class="line">    onBackground = Color(<span class="number">0xFF1C1B1F</span>),</span><br><span class="line">    onSurface = Color(<span class="number">0xFF1C1B1F</span>),</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">NrcTheme</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    darkTheme: <span class="type">Boolean</span> = isSystemInDarkTheme()</span></span>,</span><br><span class="line">    dynamicColor: <span class="built_in">Boolean</span> = <span class="literal">true</span>,</span><br><span class="line">    content: <span class="meta">@Composable</span> () -&gt; <span class="built_in">Unit</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">val</span> colorScheme = <span class="keyword">when</span> &#123;</span><br><span class="line">        dynamicColor -&gt; &#123;</span><br><span class="line">            <span class="keyword">val</span> context = LocalContext.current</span><br><span class="line">            <span class="keyword">if</span> (darkTheme) dynamicDarkColorScheme(context) <span class="keyword">else</span> dynamicLightColorScheme(context)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        darkTheme -&gt; DarkColorScheme</span><br><span class="line">        <span class="keyword">else</span> -&gt; LightColorScheme</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MaterialTheme(</span><br><span class="line">        colorScheme = colorScheme,</span><br><span class="line">        typography = Typography,</span><br><span class="line">        content = content</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-字体的使用"><a href="#2-字体的使用" class="headerlink" title="2.字体的使用"></a>2.字体的使用</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一段文字有不同的大小</span></span><br><span class="line"><span class="keyword">val</span> text = buildAnnotatedString &#123; </span><br><span class="line">    append(<span class="string">&quot;text&quot;</span>) <span class="comment">//添加一段文本</span></span><br><span class="line">    withStyle(MaterialTheme.typography.titleMedium.toSpanStyle())&#123;</span><br><span class="line">        append(<span class="string">&quot;this is a test&quot;</span>) <span class="comment">//使用样式添加一段文本</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-动画"><a href="#5-动画" class="headerlink" title="5.动画"></a>5.动画</h2><h3 id="1-简单值动画"><a href="#1-简单值动画" class="headerlink" title="1.简单值动画"></a>1.简单值动画</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MainWin</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> (num,setNum) = remember &#123;</span><br><span class="line">        mutableIntStateOf(<span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//设置背景动画</span></span><br><span class="line">    <span class="keyword">val</span> backgroundColor <span class="keyword">by</span> animateColorAsState(<span class="keyword">if</span>(num == <span class="number">0</span>) Purple80 <span class="keyword">else</span> Color.Green,label = <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    NrcTheme &#123;</span><br><span class="line">        Scaffold(modifier = Modifier.fillMaxSize(), containerColor = backgroundColor) &#123; innerPadding -&gt;</span><br><span class="line">            Row(modifier = Modifier.padding(innerPadding)) &#123;</span><br><span class="line">                Button(modifier = Modifier.weight(<span class="number">1f</span>),onClick = &#123;setNum(<span class="number">0</span>)&#125;) &#123;</span><br><span class="line">                    Text(text = <span class="string">&quot;HomePage&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                Button(modifier = Modifier.weight(<span class="number">1f</span>),onClick = &#123;setNum(<span class="number">1</span>)&#125;) &#123;</span><br><span class="line">                    Text(text = <span class="string">&quot;TabBar&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-AnimatedVisibility"><a href="#2-AnimatedVisibility" class="headerlink" title="2.AnimatedVisibility"></a>2.AnimatedVisibility</h3><p><code>AnimatedVisibility</code> 是 Jetpack Compose 中的一个组件，用于在组件的可见性发生变化时添加进入和退出动画。它的主要作用是通过动画效果增强用户体验，使界面的变化更加流畅和自然。</p>
<h4 id="具体作用"><a href="#具体作用" class="headerlink" title="具体作用"></a>具体作用</h4><ol>
<li><strong>控制组件的可见性</strong><ul>
<li>通过 <code>visible</code> 或 <code>visibleState</code> 参数，可以动态控制子组件是否显示。</li>
<li>当 <code>visible</code> 为 <code>true</code> 时，子组件显示；为 <code>false</code> 时，子组件隐藏。</li>
</ul>
</li>
<li><strong>添加进入动画</strong><ul>
<li>当组件从不可见到可见时，可以通过 <code>enter</code> 参数定义进入动画。</li>
<li>常见的进入动画包括 <code>fadeIn</code>（淡入）、<code>slideIn</code>（滑入）等。</li>
</ul>
</li>
<li><strong>添加退出动画</strong><ul>
<li>当组件从可见到不可见时，可以通过 <code>exit</code> 参数定义退出动画。</li>
<li>常见的退出动画包括 <code>fadeOut</code>（淡出）、<code>slideOut</code>（滑出）等。</li>
</ul>
</li>
<li><strong>灵活组合动画效果</strong><ul>
<li>可以将多种动画效果组合使用，例如同时使用 <code>fadeIn</code> 和 <code>slideInVertically</code>。</li>
</ul>
</li>
</ol>
<h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isVisible <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line"></span><br><span class="line">Button(onClick = &#123; isVisible = !isVisible &#125;) &#123;</span><br><span class="line">    Text(<span class="string">&quot;Toggle Visibility&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AnimatedVisibility(</span><br><span class="line">    visible = isVisible,</span><br><span class="line">    enter = fadeIn() + slideInVertically(),</span><br><span class="line">    exit = fadeOut() + slideOutVertically()</span><br><span class="line">) &#123;</span><br><span class="line">    Text(<span class="string">&quot;Hello, Compose!&quot;</span>, modifier = Modifier.padding(<span class="number">16.</span>dp))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过animateContentSize可实现内容大小变化时的动画</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modifier = Modifier.padding(innerPadding).animateContentSize()</span><br></pre></td></tr></table></figure>

<h3 id="3-多值动画"><a href="#3-多值动画" class="headerlink" title="3.多值动画"></a>3.多值动画</h3><h4 id="1-使用-updateTransition-创建转场效果"><a href="#1-使用-updateTransition-创建转场效果" class="headerlink" title="1. 使用 updateTransition 创建转场效果"></a>1. 使用 <code>updateTransition</code> 创建转场效果</h4><p><code>updateTransition</code> 根据状态变化创建转场，返回的 <code>Transition</code> 对象可用来声明动画值。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title class_">BoxState</span>(<span class="keyword">val</span> color: Color, <span class="keyword">val</span> size: Dp) &#123;</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">not</span><span class="params">()</span></span> = <span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">is</span> Small) Large <span class="keyword">else</span> Small</span><br><span class="line">    <span class="keyword">object</span> Small : BoxState(Blue, <span class="number">64.</span>dp)</span><br><span class="line">    <span class="keyword">object</span> Large : BoxState(Red, <span class="number">128.</span>dp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> boxState: BoxState <span class="keyword">by</span> remember &#123; mutableStateOf(BoxState.Small) &#125;</span><br><span class="line"><span class="keyword">val</span> transition = updateTransition(targetState = boxState)</span><br></pre></td></tr></table></figure>

<h4 id="2-针对每个属性定义动画"><a href="#2-针对每个属性定义动画" class="headerlink" title="2. 针对每个属性定义动画"></a>2. 针对每个属性定义动画</h4><p>使用 <code>Transition</code> 对象上的扩展函数（如 <code>animateRect</code>、<code>animateDp</code> 等）为每个属性定义动画。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义颜色动画</span></span><br><span class="line"><span class="keyword">val</span> color <span class="keyword">by</span> transition.animateColor(label = <span class="string">&quot;Transition Tab1&quot;</span>)&#123; it-&gt;</span><br><span class="line">      it.color     <span class="comment">//targetValue                                            </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义大小动画</span></span><br><span class="line"><span class="keyword">val</span> size <span class="keyword">by</span> transition.animateDp(transitionSpec = &#123;</span><br><span class="line">    <span class="keyword">if</span> (targetState == BoxState.Large) &#123;</span><br><span class="line">        spring(stiffness = Spring.StiffnessVeryLow)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        spring(stiffness = Spring.StiffnessHigh)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, label = <span class="string">&quot;Transition Tab2&quot;</span>) &#123;it -&gt;</span><br><span class="line">	 it.size <span class="comment">//targetValue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-在可组合项中应用动画值"><a href="#3-在可组合项中应用动画值" class="headerlink" title="3. 在可组合项中应用动画值"></a>3. 在可组合项中应用动画值</h4><p>在可组合项中使用动画值，使界面随状态变化而平滑过渡。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Button(</span><br><span class="line">    onClick = &#123; boxState = !boxState &#125;</span><br><span class="line">) &#123;</span><br><span class="line">    Text(<span class="string">&quot;Change Color and size&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">Spacer(Modifier.height(<span class="number">16.</span>dp))</span><br><span class="line">Box(</span><br><span class="line">    Modifier</span><br><span class="line">    .size(size)</span><br><span class="line">    .background(color)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="4-自定义动画行为"><a href="#4-自定义动画行为" class="headerlink" title="4. 自定义动画行为"></a>4. 自定义动画行为</h4><p>通过 <code>transitionSpec</code> 参数自定义动画行为，如动画时长、缓动函数等。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> size <span class="keyword">by</span> transition.animateDp(transitionSpec = &#123;</span><br><span class="line">    <span class="keyword">if</span> (targetState == BoxState.Large) &#123;</span><br><span class="line">        spring(stiffness = Spring.StiffnessVeryLow)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        spring(stiffness = Spring.StiffnessHigh)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, label = <span class="string">&quot;Transition Tab2&quot;</span>) &#123;it -&gt;</span><br><span class="line">                               it.size</span><br><span class="line">                              &#125;</span><br></pre></td></tr></table></figure>

<h4 id="示例：多值动画完整代码"><a href="#示例：多值动画完整代码" class="headerlink" title="示例：多值动画完整代码"></a>示例：多值动画完整代码</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title class_">BoxState</span>(<span class="keyword">val</span> color: Color, <span class="keyword">val</span> size: Dp) &#123;</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">not</span><span class="params">()</span></span> = <span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">is</span> Small) Large <span class="keyword">else</span> Small</span><br><span class="line">    <span class="keyword">object</span> Small : BoxState(Blue, <span class="number">64.</span>dp)</span><br><span class="line">    <span class="keyword">object</span> Large : BoxState(Red, <span class="number">128.</span>dp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">UpdateTransitionDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> boxState: BoxState <span class="keyword">by</span> remember &#123; mutableStateOf(BoxState.Small) &#125;</span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(targetState = boxState)</span><br><span class="line"></span><br><span class="line">    Column(Modifier.padding(<span class="number">16.</span>dp)) &#123;</span><br><span class="line">        Spacer(Modifier.height(<span class="number">16.</span>dp))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> color <span class="keyword">by</span> transition.animateColor(label = <span class="string">&quot;Transition Tab1&quot;</span>)&#123; it-&gt;</span><br><span class="line">            it.color</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> size <span class="keyword">by</span> transition.animateDp(transitionSpec = &#123;</span><br><span class="line">            <span class="keyword">if</span> (targetState == BoxState.Large) &#123;</span><br><span class="line">                spring(stiffness = Spring.StiffnessVeryLow)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                spring(stiffness = Spring.StiffnessHigh)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, label = <span class="string">&quot;Transition Tab2&quot;</span>) &#123;it -&gt;</span><br><span class="line">            it.size</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Button(</span><br><span class="line">            onClick = &#123; boxState = !boxState &#125;</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(<span class="string">&quot;Change Color and size&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        Spacer(Modifier.height(<span class="number">16.</span>dp))</span><br><span class="line">        Box(</span><br><span class="line">            Modifier</span><br><span class="line">                .size(size)</span><br><span class="line">                .background(color)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-重复动画"><a href="#4-重复动画" class="headerlink" title="4.重复动画"></a>4.重复动画</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用rememberInfiniteTransition</span></span><br><span class="line"><span class="keyword">val</span> infiniteTransition = rememberInfiniteTransition(label = <span class="string">&quot;infiniteTransition&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 透明度动画</span></span><br><span class="line"><span class="keyword">val</span> alpha <span class="keyword">by</span> infiniteTransition.animateFloat(</span><br><span class="line">    initialValue = <span class="number">0f</span>, <span class="comment">//初始值</span></span><br><span class="line">    targetValue = <span class="number">1f</span>, <span class="comment">//最终值</span></span><br><span class="line">    animationSpec = infiniteRepeatable( <span class="comment">//重复动画</span></span><br><span class="line">        animation = tween(<span class="number">1000</span>, easing = LinearOutSlowInEasing),</span><br><span class="line">        repeatMode = RepeatMode.Reverse</span><br><span class="line">    ), label = <span class="string">&quot;Test&quot;</span></span><br><span class="line">)</span><br><span class="line">Box(</span><br><span class="line">    modifier = Modifier</span><br><span class="line">    .size(<span class="number">100.</span>dp)</span><br><span class="line">    .background(Color.Blue)</span><br><span class="line">    .alpha(alpha) <span class="comment">// 应用透明度动画</span></span><br><span class="line">) &#123;</span><br><span class="line">    Text(</span><br><span class="line">        text = <span class="string">&quot;Multi-Property Animation&quot;</span>,</span><br><span class="line">        modifier = Modifier.align(Alignment.Center)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-手势动画"><a href="#5-手势动画" class="headerlink" title="5.手势动画"></a>5.手势动画</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> list = mutableStateListOf(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MainWIn</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> onRemove:(<span class="built_in">Int</span>)-&gt;<span class="built_in">Unit</span> = &#123; a -&gt;</span><br><span class="line">        list.remove(a)</span><br><span class="line">    &#125;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">for</span> (index <span class="keyword">in</span> list)&#123;</span><br><span class="line">            Box(modifier = Modifier.swipe(ondismiss = &#123; onRemove(index) &#125;).height(<span class="number">100.</span>dp).fillMaxWidth().padding(start = <span class="number">10.</span>dp, top = <span class="number">10.</span>dp, end = <span class="number">10.</span>dp).background(color = Color.Green))&#123;</span><br><span class="line">                Text(text = <span class="string">&quot;this is <span class="variable">$index</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> Modifier.<span class="title">swipe</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    ondismiss: () -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>:Modifier = composed&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建动画</span></span><br><span class="line">    <span class="keyword">val</span> offsetX = remember &#123;</span><br><span class="line">        Animatable(<span class="number">0f</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pointerInput(<span class="built_in">Unit</span>)&#123;</span><br><span class="line">        <span class="comment">//创建一个基于样条函数的减速计算对象，用于计算滑动结束时的减速效果。</span></span><br><span class="line">        <span class="keyword">val</span> decay = splineBasedDecay&lt;<span class="built_in">Float</span>&gt;(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">        coroutineScope &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="comment">//等待触摸事件</span></span><br><span class="line">                <span class="keyword">val</span> pointerId = awaitPointerEventScope &#123; awaitFirstDown().id &#125;</span><br><span class="line">                <span class="comment">//记录滑动的速度</span></span><br><span class="line">                <span class="keyword">val</span> velocityTracker = VelocityTracker()</span><br><span class="line">                <span class="comment">//等待拖动事件</span></span><br><span class="line">                awaitPointerEventScope &#123;</span><br><span class="line">                    horizontalDrag(pointerId)&#123; change-&gt;</span><br><span class="line">                        <span class="comment">//水平偏移量</span></span><br><span class="line">                        <span class="keyword">val</span> horizontalDragOffset = offsetX.value + change.positionChange().x</span><br><span class="line">                        launch &#123;</span><br><span class="line">                            offsetX.snapTo(horizontalDragOffset)</span><br><span class="line">                        &#125;</span><br><span class="line">                        velocityTracker.addPosition(change.uptimeMillis,change.position)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//计算速度</span></span><br><span class="line">                <span class="keyword">val</span> velocity = velocityTracker.calculateVelocity().x</span><br><span class="line">                <span class="comment">//计算最终的位置</span></span><br><span class="line">                <span class="keyword">val</span> targetPosition = decay.calculateTargetValue(offsetX.value,velocity)</span><br><span class="line">                launch &#123;</span><br><span class="line">                    <span class="keyword">if</span> (targetPosition.absoluteValue &lt;= size.width)&#123;</span><br><span class="line">                        <span class="comment">//如果距离不够 则按原速度滑回路</span></span><br><span class="line">                        offsetX.animateTo(<span class="number">0f</span>, initialVelocity = velocity)</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        offsetX.animateDecay(velocity,decay)</span><br><span class="line">                        ondismiss()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.offset &#123;</span><br><span class="line">        IntOffset(offsetX.value.roundToInt(),<span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>函数定义</strong></li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> Modifier.<span class="title">swipe</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    ondismiss: () -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Modifier = composed &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义了一个私有的 Modifier 扩展函数 <code>swipe</code>，接收一个回调函数 <code>ondismiss</code>。</li>
<li>使用 <code>composed</code> 构建一个可组合的 Modifier，以便在其中使用可组合函数和状态。</li>
</ul>
<h4 id="2-动画状态初始化"><a href="#2-动画状态初始化" class="headerlink" title="2. 动画状态初始化"></a>2. <strong>动画状态初始化</strong></h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> offsetX = remember &#123;</span><br><span class="line">    Animatable(<span class="number">0f</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>remember</code> 创建一个可动画化的状态 <code>offsetX</code>，初始值为 0，用于跟踪水平偏移量。</li>
</ul>
<h4 id="3-触摸事件处理"><a href="#3-触摸事件处理" class="headerlink" title="3. 触摸事件处理"></a>3. <strong>触摸事件处理</strong></h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pointerInput(<span class="built_in">Unit</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> decay = splineBasedDecay&lt;<span class="built_in">Float</span>&gt;(<span class="keyword">this</span>)</span><br><span class="line">    coroutineScope &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">val</span> pointerId = awaitPointerEventScope &#123; awaitFirstDown().id &#125;</span><br><span class="line">            <span class="keyword">val</span> velocityTracker = VelocityTracker()</span><br><span class="line">            awaitPointerEventScope &#123;</span><br><span class="line">                horizontalDrag(pointerId) &#123; change -&gt;</span><br><span class="line">                    <span class="keyword">val</span> horizontalDragOffset = offsetX.value + change.positionChange().x</span><br><span class="line">                    launch &#123; offsetX.snapTo(horizontalDragOffset) &#125;</span><br><span class="line">                    velocityTracker.addPosition(change.uptimeMillis, change.position)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">val</span> velocity = velocityTracker.calculateVelocity().x</span><br><span class="line">            <span class="keyword">val</span> targetPosition = decay.calculateTargetValue(offsetX.value, velocity)</span><br><span class="line">            launch &#123;</span><br><span class="line">                <span class="keyword">if</span> (targetPosition.absoluteValue &lt;= size.width) &#123;</span><br><span class="line">                    offsetX.animateTo(<span class="number">0f</span>, initialVelocity = velocity)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    offsetX.animateDecay(velocity, decay)</span><br><span class="line">                    ondismiss()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>**<code>pointerInput</code>**：处理触摸事件。</li>
<li>**<code>splineBasedDecay</code>**：创建一个基于样条函数的减速计算对象，用于计算滑动结束时的减速效果。</li>
<li>**<code>coroutineScope</code>**：启动一个协程作用域，用于处理异步任务。</li>
<li>**<code>while (true)</code>**：无限循环，持续监听触摸事件。</li>
<li>**<code>awaitFirstDown</code>**：等待第一个触摸点按下，获取其 <code>pointerId</code>。</li>
<li>**<code>velocityTracker</code>**：记录滑动速度。</li>
<li>**<code>horizontalDrag</code>**：监听水平拖动事件，更新 <code>offsetX</code> 的值，并记录滑动位置和时间。</li>
<li>**<code>calculateVelocity</code>**：计算滑动速度。</li>
<li>**<code>decay.calculateTargetValue</code>**：根据当前偏移量和速度，计算滑动结束时的目标位置。</li>
<li><strong>动画逻辑</strong>：<ul>
<li>如果滑动距离小于屏幕宽度，则动画回到初始位置。</li>
<li>否则，执行减速动画并调用 <code>ondismiss</code> 回调。</li>
</ul>
</li>
</ul>
<h4 id="4-应用偏移量"><a href="#4-应用偏移量" class="headerlink" title="4. 应用偏移量"></a>4. <strong>应用偏移量</strong></h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.offset &#123;</span><br><span class="line">    IntOffset(offsetX.value.roundToInt(), <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>offset</code> 修改器，根据 <code>offsetX</code> 的值对组件进行水平偏移。</li>
</ul>
<h2 id="6-手势"><a href="#6-手势" class="headerlink" title="6.手势"></a>6.手势</h2><h3 id="1-点击手势"><a href="#1-点击手势" class="headerlink" title="1.点击手势"></a>1.点击手势</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Modifier.pointerInput(<span class="built_in">Unit</span>) &#123; </span><br><span class="line">    detectTapGestures(</span><br><span class="line">        onTap = &#123;&#125;,</span><br><span class="line">        onPress = &#123;&#125;,</span><br><span class="line">        onDoubleTap = &#123;&#125;,</span><br><span class="line">        onLongPress = &#123;&#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>onTap</strong></li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onTap = &#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>作用</strong>：处理单击事件。</li>
<li><strong>触发条件</strong>：当用户在组件上快速点击一次时触发。</li>
<li><strong>适用场景</strong>：常用于实现按钮点击、选择项等功能。</li>
</ul>
<ol start="2">
<li><strong>onDoubleTap</strong></li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onDoubleTap = &#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>作用</strong>：处理双击事件。</li>
<li><strong>触发条件</strong>：当用户在组件上快速连续点击两次时触发。</li>
<li><strong>适用场景</strong>：常用于实现双击放大图片、双击刷新等功能。</li>
</ul>
<ol start="3">
<li><strong>onLongPress</strong></li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onLongPress = &#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>作用</strong>：处理长按事件。</li>
<li><strong>触发条件</strong>：当用户在组件上按住一段时间（通常为500ms以上）时触发。</li>
<li><strong>适用场景</strong>：常用于实现长按弹出菜单、长按拖动元素等功能。</li>
</ul>
<ol start="4">
<li><strong>onPress</strong></li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onPress = &#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>作用</strong>：处理按下事件。</li>
<li><strong>触发条件</strong>：当用户在组件上按下时触发，无论是否释放。</li>
<li><strong>适用场景</strong>：常用于实现按下时的视觉反馈、按下时开始某些操作等功能。</li>
</ul>
<h3 id="2-滚动修饰符"><a href="#2-滚动修饰符" class="headerlink" title="2.滚动修饰符"></a>2.滚动修饰符</h3><blockquote>
<p>verticalScroll</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Scroll</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> state = rememberScrollState()</span><br><span class="line">    LaunchedEffect(<span class="built_in">Unit</span>) &#123;</span><br><span class="line">        state.animateScrollTo(<span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    Column(modifier = Modifier.background(Color.LightGray).padding(<span class="number">2.</span>dp).size(<span class="number">100.</span>dp).verticalScroll(state)) &#123;</span><br><span class="line">        repeat(<span class="number">10</span>)&#123;</span><br><span class="line">            Text(text = <span class="string">&quot;this is <span class="variable">$it</span>&quot;</span>, modifier = Modifier.padding(<span class="number">2.</span>dp))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-可滚动修饰符"><a href="#3-可滚动修饰符" class="headerlink" title="3.可滚动修饰符"></a>3.可滚动修饰符</h3><blockquote>
<p>Scrollable,可以检测滑动手势，而不改变界面</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ScrollAble</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> offset <span class="keyword">by</span> remember &#123;</span><br><span class="line">        mutableStateOf(<span class="number">0f</span>) <span class="comment">//记录偏移量</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Box(modifier = Modifier</span><br><span class="line">        .size(<span class="number">200.</span>dp)</span><br><span class="line">        .scrollable(</span><br><span class="line">            orientation = Orientation.Vertical, <span class="comment">//记录垂直方向的</span></span><br><span class="line">            state = rememberScrollableState &#123; delta -&gt;</span><br><span class="line">                offset += delta </span><br><span class="line">                delta</span><br><span class="line">            &#125;</span><br><span class="line">        ), contentAlignment = Alignment.Center)&#123;</span><br><span class="line">        Text(text = offset.toString())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-嵌套滚动"><a href="#4-嵌套滚动" class="headerlink" title="4.嵌套滚动"></a>4.嵌套滚动</h3><blockquote>
<p>嵌套滚动机制允许一个可滚动的组件在其内部包含另一个可滚动的组件，并且两者可以协调滚动行为，使得用户体验更加流畅和自然。</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">CloumTest</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> gradient = Brush.verticalGradient( <span class="comment">//构造渐变器</span></span><br><span class="line">        <span class="number">0f</span> to Color.Green,<span class="number">1000f</span> to Color.Yellow</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    Box(modifier = Modifier</span><br><span class="line">        .size(<span class="number">200.</span>dp)</span><br><span class="line">        .background(Color.LightGray)</span><br><span class="line">        .verticalScroll(</span><br><span class="line">            rememberScrollState()</span><br><span class="line">        )</span><br><span class="line">        .padding(<span class="number">5.</span>dp))&#123;</span><br><span class="line">        Column &#123;</span><br><span class="line">            repeat(<span class="number">6</span>)&#123;</span><br><span class="line">                Text(</span><br><span class="line">                    text = <span class="string">&quot;this is <span class="variable">$it</span>&quot;</span>,</span><br><span class="line">                    modifier = Modifier</span><br><span class="line">                        .height(<span class="number">120.</span>dp).background(gradient).fillMaxWidth()</span><br><span class="line">                        .border(<span class="number">12.</span>dp, Color.DarkGray)</span><br><span class="line">                        .padding(<span class="number">24.</span>dp)</span><br><span class="line">                        .verticalScroll(rememberScrollState())</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>构造渐变</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> gradient = Brush.verticalGradient( <span class="comment">//构造渐变器</span></span><br><span class="line">    <span class="number">0f</span> to Color.Green,<span class="number">1000f</span> to Color.Yellow</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="5-拖动"><a href="#5-拖动" class="headerlink" title="5.拖动"></a>5.拖动</h3><blockquote>
<p>实现拖动单一方向</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DragWin</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> offsetX <span class="keyword">by</span> remember &#123;</span><br><span class="line">        mutableStateOf(<span class="number">0f</span>) <span class="comment">//记录水平的偏移量</span></span><br><span class="line">    &#125;</span><br><span class="line">    Text(modifier = Modifier</span><br><span class="line">        .offset &#123; IntOffset(offsetX.roundToInt(), <span class="number">0</span>) &#125;</span><br><span class="line">        .size(<span class="number">150.</span>dp)</span><br><span class="line">        .draggable( <span class="comment">//设置为可拖动</span></span><br><span class="line">            orientation = Orientation.Horizontal, <span class="comment">//检测水平位置</span></span><br><span class="line">            state = rememberDraggableState &#123; delta -&gt;</span><br><span class="line">                offsetX += delta</span><br><span class="line">            &#125;</span><br><span class="line">        ),text = <span class="string">&quot;dragable&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>任意位置拖动</p>
<p>使用pointerInput的detectDragGestures检测拖动手势</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需要多个手势</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DragEveryWhere</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Box(modifier = Modifier.fillMaxSize())&#123;</span><br><span class="line">        <span class="keyword">var</span> offsetX <span class="keyword">by</span> remember &#123;</span><br><span class="line">            mutableStateOf(<span class="number">0f</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> offsetY <span class="keyword">by</span> remember &#123;</span><br><span class="line">            mutableStateOf(<span class="number">0f</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Box(</span><br><span class="line">            modifier = Modifier</span><br><span class="line">                .background(Color.Blue)</span><br><span class="line">                .size(<span class="number">50.</span>dp)</span><br><span class="line">                .offset &#123; IntOffset(offsetX.roundToInt(), offsetY.roundToInt()) &#125;</span><br><span class="line">                .pointerInput(<span class="built_in">Unit</span>) &#123;</span><br><span class="line">                    detectDragGestures &#123; change, dragAmount -&gt;</span><br><span class="line">                        offsetX += dragAmount.x</span><br><span class="line">                        offsetY += dragAmount.y</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)&#123;</span><br><span class="line">            Text(text = <span class="string">&quot;drag&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-多点触控"><a href="#6-多点触控" class="headerlink" title="6.多点触控"></a>6.多点触控</h3><blockquote>
<p>平移，旋转，缩放</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">GraSample</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> scaleoffset <span class="keyword">by</span> remember &#123; <span class="comment">//缩放</span></span><br><span class="line">        mutableStateOf(<span class="number">1f</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> rotation <span class="keyword">by</span> remember &#123; <span class="comment">//旋转</span></span><br><span class="line">        mutableStateOf(<span class="number">0f</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> offset <span class="keyword">by</span> remember &#123; <span class="comment">//平移</span></span><br><span class="line">        mutableStateOf(Offset.Zero)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> state = rememberTransformableState &#123; zoomChange, panChange, rotationChange -&gt;</span><br><span class="line">        scaleoffset += zoomChange</span><br><span class="line">        rotation += rotationChange</span><br><span class="line">        offset += panChange</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Box(modifier = Modifier.background(Color.Yellow).size(<span class="number">200.</span>dp)</span><br><span class="line">        .graphicsLayer &#123;</span><br><span class="line">            scaleX = scaleoffset</span><br><span class="line">            scaleY = scaleoffset</span><br><span class="line">            rotationZ = rotation</span><br><span class="line">            rotationX = offset.x</span><br><span class="line">            rotationY = offset.y</span><br><span class="line">        &#125;</span><br><span class="line">        .transformable(state)) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-View-Compose"><a href="#7-View-Compose" class="headerlink" title="7.View&amp;Compose"></a>7.View&amp;Compose</h2><h3 id="1-View中使用Compose"><a href="#1-View中使用Compose" class="headerlink" title="1.View中使用Compose"></a>1.View中使用Compose</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">androidx.compose.ui.platform.ComposeView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/tv_main&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在代码中定义获取实例</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 ComposeView 的实例</span></span><br><span class="line"><span class="keyword">val</span> composeView = findViewById&lt;ComposeView&gt;(R.id.tv_main)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 setContent 方法设置 ComposeView 的内容</span></span><br><span class="line">composeView.setContent &#123;</span><br><span class="line">    <span class="comment">// 在这里定义你的 Compose UI</span></span><br><span class="line">    Text(<span class="string">&quot;Hello, Compose!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Compose中使用View"><a href="#2-Compose中使用View" class="headerlink" title="2.Compose中使用View"></a>2.Compose中使用View</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AndroidDesc</span><span class="params">(desc:<span class="type">String</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> htmldesc = remember(desc) &#123;</span><br><span class="line">        HtmlCompat.fromHtml(desc, HtmlCompat.FROM_HTML_MODE_COMPACT)</span><br><span class="line">    &#125;</span><br><span class="line">    AndroidView(factory = &#123;context -&gt;</span><br><span class="line">        TextView(context).apply &#123;</span><br><span class="line">            <span class="comment">//设置TextView为可点击</span></span><br><span class="line">            movementMethod = LinkMovementMethod.getInstance()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, update = &#123; textView -&gt;</span><br><span class="line">        textView.text = htmldesc</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Navigation"><a href="#3-Navigation" class="headerlink" title="3.Navigation"></a>3.Navigation</h3><h4 id="1-添加依赖项"><a href="#1-添加依赖项" class="headerlink" title="1.添加依赖项"></a>1.添加依赖项</h4><p>确保在你的 <code>build.gradle</code> 文件中添加了以下依赖项：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="keyword">val</span> nav_version = <span class="string">&quot;2.8.9&quot;</span></span><br><span class="line">    implementation(<span class="string">&quot;androidx.navigation:navigation-compose:<span class="variable">$nav_version</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(libs.androidx.navigation.compose)</span><br></pre></td></tr></table></figure>

<h4 id="2-创建-NavController-和-NavHost"><a href="#2-创建-NavController-和-NavHost" class="headerlink" title="2. 创建 NavController 和 NavHost"></a>2. 创建 <code>NavController</code> 和 <code>NavHost</code></h4><p>在你的可组合项中，创建一个 <code>NavController</code> 实例，并使用 <code>NavHost</code> 来定义导航图。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyApp</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 创建 NavController 实例</span></span><br><span class="line">    <span class="keyword">val</span> navController = rememberNavController()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 NavHost 定义导航图</span></span><br><span class="line">    NavHost(</span><br><span class="line">        navController = navController,</span><br><span class="line">        startDestination = <span class="string">&quot;home&quot;</span> <span class="comment">// 设置初始目的地</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="comment">// 定义可组合项作为导航目的地</span></span><br><span class="line">        composable(<span class="string">&quot;home&quot;</span>) &#123;</span><br><span class="line">            HomeScreen(navController)</span><br><span class="line">        &#125;</span><br><span class="line">        composable(<span class="string">&quot;details&quot;</span>) &#123;</span><br><span class="line">            DetailsScreen(navController)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：主页屏幕</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">HomeScreen</span><span class="params">(navController: <span class="type">NavController</span>)</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.fillMaxSize(),</span><br><span class="line">        verticalArrangement = Arrangement.Center,</span><br><span class="line">        horizontalAlignment = Alignment.CenterHorizontally</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;Home Screen&quot;</span>)</span><br><span class="line">        Button(onClick = &#123; navController.navigate(<span class="string">&quot;details&quot;</span>) &#125;) &#123;</span><br><span class="line">            Text(<span class="string">&quot;Go to Details&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：详情屏幕</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DetailsScreen</span><span class="params">(navController: <span class="type">NavController</span>)</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.fillMaxSize(),</span><br><span class="line">        verticalArrangement = Arrangement.Center,</span><br><span class="line">        horizontalAlignment = Alignment.CenterHorizontally</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;Details Screen&quot;</span>)</span><br><span class="line">        Button(onClick = &#123; navController.navigateUp() &#125;) &#123;</span><br><span class="line">            Text(<span class="string">&quot;Back to Home&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>点击按钮切换</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navController.navigate(name)</span><br></pre></td></tr></table></figure>

<h3 id="3-参数的传递"><a href="#3-参数的传递" class="headerlink" title="3.参数的传递"></a>3.参数的传递</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">composable(<span class="string">&quot;home/&#123;name&#125;&quot;</span>, arguments = listOf(</span><br><span class="line">    navArgument(<span class="string">&quot;name&quot;</span>)&#123;</span><br><span class="line">        type = NavType.StringType <span class="comment">//指定name的类型为String</span></span><br><span class="line">    &#125;</span><br><span class="line">))&#123;entry-&gt;</span><br><span class="line">   <span class="keyword">val</span> text = entry.arguments?.getString(<span class="string">&quot;name&quot;</span>) <span class="comment">//获取参数</span></span><br><span class="line">   Text(text = <span class="string">&quot;test1 <span class="variable">$text</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-深层链接"><a href="#4-深层链接" class="headerlink" title="4.深层链接"></a>4.深层链接</h3><h4 id="1-定义深层链接"><a href="#1-定义深层链接" class="headerlink" title="1. 定义深层链接"></a>1. 定义深层链接</h4><p>在 <code>composable</code> 函数中，使用 <code>deepLinks</code> 参数定义深层链接。<code>deepLinks</code> 参数接受一系列 <code>NavDeepLink</code> 对象，可以使用 <code>navDeepLink</code> 方法快速创建。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyApp</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> navController = rememberNavController()</span><br><span class="line"></span><br><span class="line">    NavHost(navController = navController, startDestination = <span class="string">&quot;home&quot;</span>) &#123;</span><br><span class="line">        composable(</span><br><span class="line">            route = <span class="string">&quot;home&quot;</span>,</span><br><span class="line">            deepLinks = listOf(</span><br><span class="line">                navDeepLink &#123;</span><br><span class="line">                    uriPattern = <span class="string">&quot;https://www.example.com/home&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        ) &#123;</span><br><span class="line">            HomeScreen(navController)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        composable(</span><br><span class="line">            route = <span class="string">&quot;details/&#123;userId&#125;&quot;</span>,</span><br><span class="line">            arguments = listOf(navArgument(<span class="string">&quot;userId&quot;</span>) &#123; type = NavType.StringType &#125;),</span><br><span class="line">            deepLinks = listOf(</span><br><span class="line">                navDeepLink &#123;</span><br><span class="line">                    uriPattern = <span class="string">&quot;https://www.example.com/details/&#123;userId&#125;&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        ) &#123; backStackEntry -&gt;</span><br><span class="line">            DetailsScreen(</span><br><span class="line">                navController,</span><br><span class="line">                userId = backStackEntry.arguments?.getString(<span class="string">&quot;userId&quot;</span>) ?: <span class="string">&quot;&quot;</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-配置-AndroidManifest-xml"><a href="#2-配置-AndroidManifest-xml" class="headerlink" title="2. 配置 AndroidManifest.xml"></a>2. 配置 <code>AndroidManifest.xml</code></h4><p>为了使应用能够处理深层链接，需要在 <code>AndroidManifest.xml</code> 中为活动添加 <code>&lt;intent-filter&gt;</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.VIEW&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.BROWSABLE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">&quot;https&quot;</span> <span class="attr">android:host</span>=<span class="string">&quot;www.example.com&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-处理深层链接"><a href="#3-处理深层链接" class="headerlink" title="3. 处理深层链接"></a>3. 处理深层链接</h4><p>在目标可组合项中，可以通过 <code>backStackEntry.arguments</code> 获取传递的参数。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DetailsScreen</span><span class="params">(navController: <span class="type">NavController</span>, userId: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.fillMaxSize(),</span><br><span class="line">        verticalArrangement = Arrangement.Center,</span><br><span class="line">        horizontalAlignment = Alignment.CenterHorizontally</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;User ID: <span class="variable">$userId</span>&quot;</span>)</span><br><span class="line">        Button(onClick = &#123; navController.navigateUp() &#125;) &#123;</span><br><span class="line">            Text(<span class="string">&quot;Back to Home&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-测试深层链接"><a href="#4-测试深层链接" class="headerlink" title="4. 测试深层链接"></a>4. 测试深层链接</h4><p>你可以通过以下方式测试深层链接：</p>
<ol>
<li><p><strong>使用 adb 命令</strong>：</p>
<p>bash复制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -d <span class="string">&quot;https://www.example.com/details/123&quot;</span> -a android.intent.action.VIEW</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在浏览器中打开链接</strong>： 打开浏览器并访问 <code>https://www.example.com/details/123</code>，应用应该会启动并导航到详情页面。</p>
</li>
</ol>
<h4 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h4><p>如果你需要更复杂的深层链接处理，可以使用类型安全的深层链接。这需要定义一个数据类来表示深层链接的参数。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Serializable</span></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Profile</span>(<span class="keyword">val</span> userId: String)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyApp</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> navController = rememberNavController()</span><br><span class="line"></span><br><span class="line">    NavHost(navController = navController, startDestination = <span class="string">&quot;home&quot;</span>) &#123;</span><br><span class="line">        composable&lt;Profile&gt;(</span><br><span class="line">            deepLinks = listOf(</span><br><span class="line">                navDeepLink&lt;Profile&gt;(basePath = <span class="string">&quot;https://www.example.com/profile&quot;</span>)</span><br><span class="line">            )</span><br><span class="line">        ) &#123; backStackEntry -&gt;</span><br><span class="line">            ProfileScreen(userId = backStackEntry.toRoute&lt;Profile&gt;().userId)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-附带效果"><a href="#8-附带效果" class="headerlink" title="8.附带效果"></a>8.附带效果</h2><p><code>LaunchedEffect</code> 第一次调用Compose函数时被调用</p>
<p><code>DisposableEffect</code> 页面退出时调用</p>
<p><code>sideEffect</code>compose函数每次执行都会调用该方法</p>
<h3 id="1-LaunchedEffect"><a href="#1-LaunchedEffect" class="headerlink" title="1.LaunchedEffect"></a>1.LaunchedEffect</h3><ul>
<li><code>LaunchedEffect</code> 的 <code>key1</code> 参数绑定到 <code>showDialog</code> 状态。当 <code>showDialog</code> 的值发生变化时，<code>LaunchedEffect</code> 会重新执行。</li>
<li>在 <code>LaunchedEffect</code> 中，你可以执行一些副作用操作，比如延迟关闭对话框。</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MessagesBox</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> showDialog <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">true</span>) &#125;</span><br><span class="line"></span><br><span class="line">    LaunchedEffect(key1 = showDialog) &#123;</span><br><span class="line">        <span class="keyword">if</span> (showDialog) &#123;</span><br><span class="line">            <span class="comment">// 这里可以执行一些异步操作，比如延迟关闭对话框</span></span><br><span class="line">            delay(<span class="number">3000</span>) <span class="comment">// 假设对话框显示3秒后自动关闭</span></span><br><span class="line">            showDialog = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Scaffold(</span><br><span class="line">        topBar = &#123;</span><br><span class="line">            TopAppBar(title = &#123; Text(text = <span class="string">&quot;rc&quot;</span>) &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        content = &#123; padding -&gt;</span><br><span class="line">            Box(</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .fillMaxSize()</span><br><span class="line">                    .padding(padding),</span><br><span class="line">                contentAlignment = Alignment.Center</span><br><span class="line">            ) &#123;</span><br><span class="line">                Button(onClick = &#123; showDialog = <span class="literal">true</span> &#125;) &#123;</span><br><span class="line">                    Text(text = <span class="string">&quot;Click Me&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (showDialog) &#123;</span><br><span class="line">        AlertDialog(</span><br><span class="line">            onDismissRequest = &#123; showDialog = <span class="literal">false</span> &#125;,</span><br><span class="line">            title = &#123; Text(<span class="string">&quot;Dialog Title&quot;</span>) &#125;,</span><br><span class="line">            text = &#123; Text(<span class="string">&quot;This is a dialog message.&quot;</span>) &#125;,</span><br><span class="line">            confirmButton = &#123;</span><br><span class="line">                TextButton(onClick = &#123; showDialog = <span class="literal">false</span> &#125;) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-rememberCoroutineScope"><a href="#2-rememberCoroutineScope" class="headerlink" title="2.rememberCoroutineScope"></a>2.rememberCoroutineScope</h3><p>主要作用：</p>
<ol>
<li><strong>生命周期绑定</strong>：<ul>
<li><code>rememberCoroutineScope</code> 创建的 <code>CoroutineScope</code> 会与组合的生命周期绑定。当组合被销毁时，该作用域内的所有协程都会被自动取消，从而避免内存泄漏。</li>
</ul>
</li>
<li><strong>启动协程</strong>：<ul>
<li>在 Compose 中，你可以使用 <code>rememberCoroutineScope</code> 获取的 <code>CoroutineScope</code> 来启动协程，执行异步或耗时操作。</li>
</ul>
</li>
<li><strong>状态管理</strong>：<ul>
<li>通常与可变状态（如 <code>mutableStateOf</code>）结合使用，通过协程更新 UI 状态，触发界面重组。</li>
</ul>
</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyBoxed</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> drawerState = rememberDrawerState(initialValue = DrawerValue.Closed)</span><br><span class="line">    <span class="keyword">val</span> scope = rememberCoroutineScope()</span><br><span class="line">    <span class="keyword">var</span> showDialog <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line"></span><br><span class="line">    ModalNavigationDrawer(</span><br><span class="line">        drawerState = drawerState,</span><br><span class="line">        drawerContent = &#123;</span><br><span class="line">            Box(</span><br><span class="line">                modifier = Modifier.fillMaxSize(),</span><br><span class="line">                contentAlignment = Alignment.Center</span><br><span class="line">            ) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;test&quot;</span>, fontSize = <span class="number">24.</span>sp)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ) &#123;</span><br><span class="line">        Scaffold(</span><br><span class="line">            topBar = &#123;</span><br><span class="line">                TopAppBar(</span><br><span class="line">                    title = &#123; Text(text = <span class="string">&quot;rc&quot;</span>) &#125;,</span><br><span class="line">                    navigationIcon = &#123;</span><br><span class="line">                        IconButton(onClick = &#123;</span><br><span class="line">                            scope.launch &#123;</span><br><span class="line">                                drawerState.<span class="keyword">open</span>()</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;) &#123;</span><br><span class="line">                            Icon(</span><br><span class="line">                                imageVector = Icons.Default.List,</span><br><span class="line">                                contentDescription = <span class="string">&quot;Open drawer&quot;</span></span><br><span class="line">                            )</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">            &#125;,</span><br><span class="line">            content = &#123; padding -&gt;</span><br><span class="line">                Box(</span><br><span class="line">                    modifier = Modifier</span><br><span class="line">                        .fillMaxSize()</span><br><span class="line">                        .padding(padding),</span><br><span class="line">                    contentAlignment = Alignment.Center</span><br><span class="line">                ) &#123;</span><br><span class="line">                    Button(onClick = &#123;</span><br><span class="line">                        showDialog = <span class="literal">true</span></span><br><span class="line">                    &#125;) &#123;</span><br><span class="line">                        Text(text = <span class="string">&quot;Click Me&quot;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (showDialog) &#123;</span><br><span class="line">                    AlertDialog(</span><br><span class="line">                        onDismissRequest = &#123;</span><br><span class="line">                            showDialog = <span class="literal">false</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        title = &#123; Text(<span class="string">&quot;Dialog Title&quot;</span>) &#125;,</span><br><span class="line">                        text = &#123; Text(<span class="string">&quot;This is a dialog message.&quot;</span>) &#125;,</span><br><span class="line">                        confirmButton = &#123;</span><br><span class="line">                            TextButton(onClick = &#123;</span><br><span class="line">                                showDialog = <span class="literal">false</span></span><br><span class="line">                            &#125;) &#123;</span><br><span class="line">                                Text(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            floatingActionButton = &#123;</span><br><span class="line">                ExtendedFloatingActionButton(</span><br><span class="line">                    onClick = &#123; &#125;,</span><br><span class="line">                    icon = &#123; Icon(Icons.Filled.Edit, <span class="string">&quot;Extended FAB&quot;</span>) &#125;,</span><br><span class="line">                    text = &#123; Text(text = <span class="string">&quot;Extended FAB&quot;</span>) &#125;,</span><br><span class="line">                )</span><br><span class="line">            &#125;,</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-rememberUpdatedState"><a href="#3-rememberUpdatedState" class="headerlink" title="3.rememberUpdatedState"></a>3.rememberUpdatedState</h3><blockquote>
<p>保证被使用时是最新值，参数被改变时不重启effect</p>
</blockquote>
<ol>
<li><strong>捕获最新状态</strong>：<ul>
<li>在组合过程中，状态值可能会发生变化。<code>rememberUpdatedState</code> 会捕获最新的状态值，并在协程或其他异步操作中使用这个最新值。</li>
</ul>
</li>
<li><strong>避免状态不一致</strong>：<ul>
<li>如果直接在协程中使用组合时的状态值，可能会导致状态不一致的问题。<code>rememberUpdatedState</code> 确保协程中使用的是最新的状态值。</li>
</ul>
</li>
<li><strong>简化状态管理</strong>：<ul>
<li>它提供了一种简单的方式在协程中管理状态的更新，而不需要手动处理状态的捕获和更新。</li>
</ul>
</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">RememberUpdatedStateExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">    <span class="keyword">val</span> currentCount = rememberUpdatedState(count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> coroutineScope = rememberCoroutineScope()</span><br><span class="line"></span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.fillMaxSize(),</span><br><span class="line">        verticalArrangement = Arrangement.Center,</span><br><span class="line">        horizontalAlignment = Alignment.CenterHorizontally</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(text = <span class="string">&quot;Count: <span class="variable">$count</span>&quot;</span>, fontSize = <span class="number">24.</span>sp)</span><br><span class="line">        Button(</span><br><span class="line">            onClick = &#123;</span><br><span class="line">                coroutineScope.launch &#123;</span><br><span class="line">                    delay(<span class="number">1000</span>) <span class="comment">// 模拟异步操作</span></span><br><span class="line">                    println(<span class="string">&quot;Current count in coroutine: <span class="subst">$&#123;currentCount.value&#125;</span>&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                count++ <span class="comment">// 更新状态</span></span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(<span class="string">&quot;Increment and Launch Coroutine&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-项目管理"><a href="#9-项目管理" class="headerlink" title="9.项目管理"></a>9.项目管理</h2><h3 id="占位符"><a href="#占位符" class="headerlink" title="占位符"></a>占位符</h3><p>为了更优雅的完成上述的问题，我们可以在strings.xml文件里，使用%s %1$s %d %1$d这些占位符，在页面设置展示的时候我们只需要将真实展示的文字或者数据替换掉就OK了。</p>
<p>占位符	类型<br>%s	替换String类型<br>%1$s	替换String类型<br>%d	替换int类型<br>%1$d	替换int类型</p>
<blockquote>
<p>注：%s 、%d为缩写方式，只替换一个位置，可以这么写</p>
</blockquote>
<h4 id="单一占位符使用"><a href="#单一占位符使用" class="headerlink" title="单一占位符使用"></a>单一占位符使用</h4><p>在strings.xml定义字符串<br><code>&lt;string name=&quot;str&quot;&gt;截止目前你已经消费了人民币%s元&lt;/string&gt;</code></p>
<h4 id="多个占位符使用"><a href="#多个占位符使用" class="headerlink" title="多个占位符使用"></a>多个占位符使用</h4><p>在strings.xml中定义<br><code>&lt;string name=&quot;str&quot;&gt;大家好，我叫%1$s，我的爱好是%2$s&lt;/string&gt;</code></p>
<h4 id="在类中使用"><a href="#在类中使用" class="headerlink" title="在类中使用"></a>在类中使用</h4><p><code>String.format(mActivity.getResources().getString(R.string. str), &quot;Rc&quot;,&quot;code&quot;))</code></p>
<p>最终的输出结果：大家好，我叫Rc，我的爱好是code</p>
<h4 id="在Compose中使用"><a href="#在Compose中使用" class="headerlink" title="在Compose中使用"></a>在Compose中使用</h4><blockquote>
<p>在string.xml文件中定义<br><code>&lt;string name=&quot;item&quot;&gt;this is a %1$s and %2$d&lt;/string&gt;</code></p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Text(text = String.format(stringResource(id = R.string.item),<span class="string">&quot;test&quot;</span>,<span class="number">30</span>))</span><br></pre></td></tr></table></figure>

<h3 id="显示到状态栏"><a href="#显示到状态栏" class="headerlink" title="显示到状态栏"></a>显示到状态栏</h3><p><code>//允许显示到状态栏内,文字显示为白色 enableEdgeToEdge(statusBarStyle = SystemBarStyle.dark(Color.TRANSPARENT))</code></p>

        </article>
        <section class="post-near">
            <ul>
                
                    <li>上一篇: <a href="/2025/03/26/Kafaka/">Kafaka</a></li>
                
                
                    <li>下一篇: <a href="/2025/03/15/AJAX/">AJAX</a></li>
                
            </ul>
        </section>
        
            <section class="post-tags">
            <a class="-none-link" href="/tags/Android/" rel="tag">Android</a><a class="-none-link" href="/tags/Kotlin/" rel="tag">Kotlin</a>
            </section>
        
    
        <section class="post-author">
        
            <figure class="author-avatar">
                <img src="https://p1.meituan.net/csc/949ad40707d4b4bab7e2ebafbd649aa8211830.jpg" alt="日初" />
            </figure>
        
            <div class="author-info">
                <h4>日初</h4>
                <p>一个什么都学的建模动画编程爱好者</p>
            </div>
        </section>
    
    </div>
</main>

    <footer>
    <div class="buttons">
        <a class="to-top" href="#"></a>
    </div>
    <div class="wrap min">
        <section class="widget">
            <div class="row">
                <div class="col-m-4">
                    <h3 class="title-recent">最新文章：</h3>
                    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/05/29/Redis/">Redis</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/05/17/MongoDB/">MongoDB</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/04/26/JUC/">JUC</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/26/Kafaka/">Kafaka</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/18/JetpackCompose/">Jetpack Compose</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/15/AJAX/">AJAX</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-date">时光机：</h3>
                    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">五月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">四月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">三月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/02/">二月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">一月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">十二月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">十一月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">十月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">九月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">八月 2024</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-tags">标签云：</h3>
                    <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/CSS/" style="font-size: 20px;">CSS</a> <a href="/tags/Docker/" style="font-size: 20px;">Docker</a> <a href="/tags/Flutter/" style="font-size: 20px;">Flutter</a> <a href="/tags/Game/" style="font-size: 20px;">Game</a> <a href="/tags/Go/" style="font-size: 20px;">Go</a> <a href="/tags/Go-Web/" style="font-size: 20px;">Go Web</a> <a href="/tags/JS/" style="font-size: 20px;">JS</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Java-Web/" style="font-size: 20px;">Java Web</a> <a href="/tags/Kotlin/" style="font-size: 20px;">Kotlin</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/MongoDB/" style="font-size: 20px;">MongoDB</a> <a href="/tags/MySql/" style="font-size: 20px;">MySql</a> <a href="/tags/MybatisPlus/" style="font-size: 20px;">MybatisPlus</a> <a href="/tags/Nginx/" style="font-size: 20px;">Nginx</a> <a href="/tags/NodeJs/" style="font-size: 20px;">NodeJs</a> <a href="/tags/QT/" style="font-size: 20px;">QT</a> <a href="/tags/React/" style="font-size: 20px;">React</a> <a href="/tags/Redis/" style="font-size: 20px;">Redis</a> <a href="/tags/Spring-Cloud/" style="font-size: 20px;">Spring Cloud</a> <a href="/tags/UniApp/" style="font-size: 20px;">UniApp</a> <a href="/tags/Unity/" style="font-size: 20px;">Unity</a> <a href="/tags/Vue/" style="font-size: 20px;">Vue</a> <a href="/tags/Webpack/" style="font-size: 20px;">Webpack</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 20px;">前端</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 20px;">运维</a>
                </div>
            </div>
        </section>
        <section class="sub-footer">
            <p>© 2025 <a href="/">Richu</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Hingle" target="_blank" rel="nofollow">Hingle</a>.</p>
        </section>
    </div>
</footer>


<script src="/static/kico.js"></script>
<script src="/static/hingle.js"></script>


<script>var hingle = new Paul_Hingle({"copyright":true,"night":false});</script>

  </body>
</html>
